# PicFlash 开发文档（基于首页功能点）

## 1. 文档目的
本文件根据首页已列出的功能点，整理成可执行的开发说明，统一功能规格、页面结构、公共能力与验收标准，便于后续逐项开发落地。

## 2. 首页功能清单（来源：`src/pages/home/index.tsx`）
### 2.1 主功能（首页大卡，立即体验）
- 图片压缩（id: `compress`）
- 图片格式转换（id: `convert`）

### 2.2 更多功能（首页小卡）
- 图片加文字（id: `text`）
- 图片格式（id: `format`）
- 九宫格拼图（id: `collage`）
- 二维码生成（id: `qrcode`）
- GIF 图制作（id: `gif`）
- 头像制作（id: `avatar`）
- 长图拼接（id: `long-image`）
- 表情包（id: `sticker`）

### 2.3 已剔除（纯前端小程序无法稳定实现）
- 图片修改 DPI（id: `dpi`）
- 抠图（id: `extract`）
- 视频变清晰（id: `video-hd`）
- 照片变清晰（id: `photo-hd`）
- 照片上色（id: `colorize`）
- 人像美颜（id: `beautify`）
- 视频压缩（id: `video-compress`）
- 视频转换格式（id: `video-convert`）

## 3. 总体页面与路由
当前页面配置在 `src/app.config.ts`：
- `pages/home/index` 首页
- `pages/index/index` 可能为落地页或测试页（待确认用途）
- `pages/profile/index` 我的

建议新增功能页结构（示例）：
- `pages/tools/compress/index`
- `pages/tools/convert/index`
其余功能按 `pages/tools/{featureId}/index` 统一管理。

## 4. 通用交互与能力规范（所有图片类功能通用）
### 4.1 选择素材
- 图片类：调用 `Taro.chooseImage`，支持相册/拍照，默认支持 `jpg/png`。

### 4.2 处理流程
- 选择素材 -> 参数配置 -> 开始处理 -> 进度展示 -> 结果预览 -> 保存/分享。
- 处理失败需明确错误原因（格式不支持、过大、处理超时等）。

### 4.3 输出与保存
- 输出格式由功能决定（如压缩后图片、转换后格式）。
- 支持保存到相册 `Taro.saveImageToPhotosAlbum`。

### 4.4 统一组件
- `UploadArea`：上传/选择入口
- `ParamPanel`：参数配置面板
- `ProgressBar`：处理进度
- `ResultPreview`：结果预览 + 保存按钮

## 5. 功能规格总表（MVP 级）
| ID | 功能 | 类型 | MVP 输出 | 状态 |
| --- | --- | --- | --- | --- |
| compress | 图片压缩 | 图片处理 | 压缩图片，支持质量/尺寸 | 首页主功能 |
| convert | 图片格式转换 | 图片处理 | jpg/png 互转 | 首页主功能 |
| text | 图片加文字 | 图片处理 | 支持文字、颜色、位置 |
| format | 图片格式 | 图片处理 | 读取/显示图片格式信息 |
| collage | 九宫格拼图 | 图片处理 | 3x3 网格拼图 |
| qrcode | 二维码生成 | 生成工具 | 输出二维码图片 |
| gif | GIF 图制作 | 图片处理 | 多图合成 GIF |
| avatar | 头像制作 | 图片处理 | 头像裁剪/圆角 |
| long-image | 长图拼接 | 图片处理 | 多图纵向拼接 |
| sticker | 表情包 | 图片处理 | 图转表情包规格 |

## 6. 详细 PRD（纯前端小程序可实现）
### 6.1 图片压缩（compress）
**目标**：在尽量不明显影响视觉质量的前提下降低图片体积。  
**入口**：首页主功能卡「图片压缩」。  
**流程**：  
1. 选择图片（单张或多张）。  
2. 设置压缩参数。  
3. 开始处理并展示进度。  
4. 展示结果与体积对比。  
5. 保存到相册。  
**参数与限制**：  
- 压缩强度：低/中/高或质量 20-90。  
- 目标尺寸：原尺寸/按宽度/按高度/等比例缩放。  
- 最大图片数量：默认 9（可配置）。  
**输出**：压缩后的图片文件（jpg/png）。  
**异常与边界**：  
- 大图或多图并发时提示“处理中，请稍候”。  
- 输入格式不支持时提示原因并返回。  
**埋点**：进入页面、选择图片、开始压缩、压缩成功/失败、保存成功/失败。  
**验收标准**：  
- 单张中等图片 2s 内完成。  
- 体积降低 20% 以上可见。  
- 多图批量处理不崩溃。  

### 6.2 图片格式转换（convert）
**目标**：在 jpg 与 png 间互转。  
**入口**：首页主功能卡「图片格式转换」。  
**流程**：  
1. 选择图片。  
2. 选择目标格式。  
3. 处理并生成结果。  
4. 保存到相册。  
**参数与限制**：  
- 目标格式：jpg/png。  
- jpg 质量：20-90。  
**输出**：目标格式图片。  
**异常与边界**：  
- 透明背景转 jpg 时提示“背景将变为白色”。  
**埋点**：进入页面、选择图片、开始转换、转换成功/失败、保存成功/失败。  
**验收标准**：  
- 成功率 > 95%。  
- 批量转换可用。  

### 6.3 图片加文字（text）
**目标**：在图片上添加一段或多段文字。  
**入口**：首页「图片加文字」。  
**流程**：  
1. 选择图片。  
2. 输入文字并调整样式与位置。  
3. 预览并导出。  
**参数与限制**：  
- 文字内容、字体大小、颜色、透明度。  
- 文字位置：拖拽或九宫格定位。  
**输出**：带文字的图片。  
**异常与边界**：  
- 超长文本自动换行或提示缩短。  
**埋点**：添加文本、修改样式、导出成功/失败。  
**验收标准**：  
- 拖拽定位准确。  
- 导出画质清晰。  

### 6.4 图片格式信息（format）
**目标**：展示图片基础信息。  
**入口**：首页「图片格式」。  
**流程**：  
1. 选择图片。  
2. 展示信息面板。  
**信息字段**：  
- 格式、像素尺寸、文件大小、色彩模式。  
**输出**：信息卡片，无导出文件。  
**异常与边界**：  
- 部分字段读取失败时显示“未获取”。  
**验收标准**：  
- 显示与系统信息一致。  

### 6.5 九宫格拼图（collage）
**目标**：生成 3x3 拼图。  
**入口**：首页「九宫格拼图」。  
**流程**：  
1. 选择 9 张图。  
2. 选择边距与背景色。  
3. 生成并导出。  
**参数与限制**：  
- 必须 9 张图。  
- 边距 0-20px，背景色可选。  
**输出**：单张拼图图片。  
**异常与边界**：  
- 少于 9 张则提示补齐。  
**验收标准**：  
- 生成图片无错位。  

### 6.6 二维码生成（qrcode）
**目标**：输入文本生成二维码图片。  
**入口**：首页「二维码生成」。  
**流程**：  
1. 输入文本/链接。  
2. 选择尺寸与前景色。  
3. 生成并保存。  
**参数与限制**：  
- 文本长度限制 1-500。  
- 尺寸 200-800px。  
**输出**：二维码图片。  
**异常与边界**：  
- 空文本禁止生成。  
**验收标准**：  
- 常见扫码工具可识别。  

### 6.7 GIF 图制作（gif）
**目标**：多张图合成为 GIF。  
**入口**：首页「GIF 图制作」。  
**流程**：  
1. 选择 2-20 张图。  
2. 设置帧率与尺寸。  
3. 生成并保存。  
**参数与限制**：  
- 帧率 5-20 fps。  
- 单 GIF 最大 10MB（建议提示）。  
**输出**：GIF 图片。  
**异常与边界**：  
- 图片过多或过大时提示“生成较慢”。  
**验收标准**：  
- 生成 GIF 能播放且不卡顿。  

### 6.8 头像制作（avatar）
**目标**：裁剪生成头像。  
**入口**：首页「头像制作」。  
**流程**：  
1. 选择图片。  
2. 裁剪为方形或圆形。  
3. 可选边框并导出。  
**参数与限制**：  
- 输出尺寸 200/400/800px。  
- 边框颜色与粗细。  
**输出**：头像图片。  
**异常与边界**：  
- 图片过小提示“清晰度不足”。  
**验收标准**：  
- 裁剪区域所见即所得。  

### 6.9 长图拼接（long-image）
**目标**：多图纵向拼接为长图。  
**入口**：首页「长图拼接」。  
**流程**：  
1. 选择 2-20 张图。  
2. 调整顺序与间距。  
3. 生成并导出。  
**参数与限制**：  
- 支持拖拽排序。  
- 间距 0-20px。  
**输出**：长图图片。  
**异常与边界**：  
- 总高度过大时提示可能失败。  
**验收标准**：  
- 拼接处无明显错位。  

### 6.10 表情包（sticker）
**目标**：生成表情包图片。  
**入口**：首页「表情包」。  
**流程**：  
1. 选择图片或模板。  
2. 添加上/下文字。  
3. 导出 PNG 或 GIF。  
**参数与限制**：  
- 预设尺寸：240/320/512px。  
- 字体大小与颜色可调。  
**输出**：表情包图片。  
**异常与边界**：  
- 文字过长自动缩小或换行。  
**验收标准**：  
- 导出后清晰可用。  

## 8. 技术实现建议（可按实际调整）
- 图片处理：小程序前端使用 Canvas 实现；避免依赖需后端/AI 的能力。
- GIF 生成：使用纯 JS 编码器，注意内存与帧数上限。
- 任务处理：前端统一任务队列管理，支持取消/重试。

## 9. 测试与验收
- 功能测试：各功能输入输出符合预期。
- 性能测试：单张图片处理耗时与内存峰值可接受。
- 兼容测试：安卓/ iOS，常见图片格式。
- 失败测试：异常提示完整。

## 10. 开发里程碑建议
1. 通用组件与基础能力（上传、参数、进度、结果）
2. 两个主功能（压缩、格式转换）
3. 二期功能按优先级逐步补齐

---
如需把某个功能扩展成详细 PRD，请指定功能 ID，我可以继续展开成完整开发规格。
