(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[648],{4354:function(e,t,n){"use strict";var s=n(8870),r=n(6540),o=n(118),a=n(758),i=n.n(a),l=n(4848);const c=({images:e,onImagesChange:t,maxCount:n=9,disabled:s=!1})=>{const[a,c]=(0,r.useState)(!1),h=()=>{if(s||a)return;const r=Math.max(1,n-e.length);i().chooseImage({count:r,sizeType:["original","compressed"],sourceType:["album","camera"],success:async n=>{c(!0);try{const s=await Promise.all(n.tempFilePaths.map(async e=>{const t=await i().getFileInfo({filePath:e});return{path:e,size:t.size}}));t([...e,...s])}catch{i().showToast({title:"\u83b7\u53d6\u56fe\u7247\u4fe1\u606f\u5931\u8d25",icon:"none"})}finally{c(!1)}},fail:e=>{e.errMsg?.includes("cancel")||i().showToast({title:"\u9009\u62e9\u5931\u8d25",icon:"none"})}})},u=n=>{const s=[...e];s.splice(n,1),t(s)};return(0,l.jsxs)(o.Ss,{className:"uploader-container",children:[(0,l.jsxs)(o.Ss,{className:"uploader-grid",children:[e.map((e,t)=>(0,l.jsxs)(o.Ss,{className:"uploader-image-wrap",children:[(0,l.jsx)(o._V,{className:"uploader-image",src:e.path,mode:"aspectFill"}),(0,l.jsx)(o.Ss,{className:"uploader-image-meta",children:(0,l.jsxs)(o.EY,{className:"uploader-size",children:[(e.size/1024).toFixed(1)," KB"]})}),!s&&(0,l.jsx)(o.Ss,{className:"uploader-remove",onClick:()=>u(t),children:(0,l.jsx)(o.EY,{className:"uploader-remove-icon",children:"\xd7"})})]},e.path)),e.length<n&&!s&&(0,l.jsxs)(o.Ss,{className:"uploader-add",onClick:h,children:[(0,l.jsx)(o.EY,{className:"uploader-add-icon",children:"+"}),(0,l.jsx)(o.EY,{className:"uploader-add-text",children:0===e.length?"\u70b9\u51fb\u9009\u62e9\u56fe\u7247":"\u6dfb\u52a0"}),a&&(0,l.jsx)(o.EY,{className:"uploader-loading",children:"\u52a0\u8f7d\u4e2d..."})]})]}),0===e.length&&!s&&(0,l.jsx)(o.EY,{className:"uploader-hint",children:"\u652f\u6301\u4ece\u76f8\u518c\u6216\u76f8\u673a\u9009\u62e9"}),e.length>0&&(0,l.jsxs)(o.EY,{className:"uploader-count",children:["\u5df2\u9009\u62e9 ",e.length," \u5f20\u56fe\u7247"]})]})};var h=c;const u=function(e,t){const n=236,s=17,r=e,o=d[t];let a=null,i=0,l=null;const c=[],h={},u=function(e,t){i=4*r+17,a=function(e){const t=new Array(e);for(let n=0;n<e;n+=1){t[n]=new Array(e);for(let s=0;s<e;s+=1)t[n][s]=null}return t}(i),f(0,0),f(i-7,0),f(0,i-7),b(),m(),k(e,t),r>=7&&N(e),null==l&&(l=j(r,o,c)),T(l,t)};var f=function(e,t){for(let n=-1;n<=7;n+=1)if(!(e+n<=-1||i<=e+n))for(let s=-1;s<=7;s+=1)t+s<=-1||i<=t+s||(a[e+n][t+s]=n>=0&&n<=6&&(0==s||6==s)||s>=0&&s<=6&&(0==n||6==n)||n>=2&&n<=4&&s>=2&&s<=4)};const g=function(){let e=0,t=0;for(let n=0;n<8;n+=1){u(!0,n);const s=p.getLostPoint(h);(0==n||e>s)&&(e=s,t=n)}return t};var m=function(){for(let e=8;e<i-8;e+=1)null==a[e][6]&&(a[e][6]=e%2==0);for(let e=8;e<i-8;e+=1)null==a[6][e]&&(a[6][e]=e%2==0)},b=function(){const e=p.getPatternPosition(r);for(let t=0;t<e.length;t+=1)for(let n=0;n<e.length;n+=1){const s=e[t],r=e[n];if(null==a[s][r])for(let e=-2;e<=2;e+=1)for(let t=-2;t<=2;t+=1)a[s+e][r+t]=-2==e||2==e||-2==t||2==t||0==e&&0==t}},N=function(e){const t=p.getBCHTypeNumber(r);for(var n=0;n<18;n+=1){var s=!e&&1==(t>>n&1);a[Math.floor(n/3)][n%3+i-8-3]=s}for(n=0;n<18;n+=1){s=!e&&1==(t>>n&1);a[n%3+i-8-3][Math.floor(n/3)]=s}},k=function(e,t){const n=o<<3|t,s=p.getBCHTypeInfo(n);for(var r=0;r<15;r+=1){var l=!e&&1==(s>>r&1);r<6?a[r][8]=l:r<8?a[r+1][8]=l:a[i-15+r][8]=l}for(r=0;r<15;r+=1){l=!e&&1==(s>>r&1);r<8?a[8][i-r-1]=l:r<9?a[8][15-r-1+1]=l:a[8][15-r-1]=l}a[i-8][8]=!e},T=function(e,t){let n=-1,s=i-1,r=7,o=0;const l=p.getMaskFunction(t);for(let t=i-1;t>0;t-=2){6==t&&(t-=1);while(1){for(let n=0;n<2;n+=1)if(null==a[s][t-n]){let i=!1;o<e.length&&(i=1==(e[o]>>>r&1));const c=l(s,t-n);c&&(i=!i),a[s][t-n]=i,r-=1,-1==r&&(o+=1,r=7)}if(s+=n,s<0||i<=s){s-=n,n=-n;break}}}};const E=function(e,t){let n=0,s=0,r=0;const o=new Array(t.length),a=new Array(t.length);for(var i=0;i<t.length;i+=1){const c=t[i].dataCount,h=t[i].totalCount-c;s=Math.max(s,c),r=Math.max(r,h),o[i]=new Array(c);for(var l=0;l<o[i].length;l+=1)o[i][l]=255&e.getBuffer()[l+n];n+=c;const u=p.getErrorCorrectPolynomial(h),f=w(o[i],u.getLength()-1),d=f.mod(u);a[i]=new Array(u.getLength()-1);for(l=0;l<a[i].length;l+=1){const e=l+d.getLength()-a[i].length;a[i][l]=e>=0?d.getAt(e):0}}let c=0;for(l=0;l<t.length;l+=1)c+=t[l].totalCount;const h=new Array(c);let u=0;for(l=0;l<s;l+=1)for(i=0;i<t.length;i+=1)l<o[i].length&&(h[u]=o[i][l],u+=1);for(l=0;l<r;l+=1)for(i=0;i<t.length;i+=1)l<a[i].length&&(h[u]=a[i][l],u+=1);return h};var j=function(e,t,r){const o=v.getRSBlocks(e,t),a=x();for(var i=0;i<r.length;i+=1){const t=r[i];a.put(t.getMode(),4),a.put(t.getLength(),p.getLengthInBits(t.getMode(),e)),t.write(a)}let l=0;for(i=0;i<o.length;i+=1)l+=o[i].dataCount;if(a.getLengthInBits()>8*l)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*l+")");a.getLengthInBits()+4<=8*l&&a.put(0,4);while(a.getLengthInBits()%8!=0)a.putBit(!1);while(1){if(a.getLengthInBits()>=8*l)break;if(a.put(n,8),a.getLengthInBits()>=8*l)break;a.put(s,8)}return E(a,o)};return h.addData=function(e){const t=y(e);c.push(t),l=null},h.isDark=function(e,t){if(e<0||i<=e||t<0||i<=t)throw new Error(e+","+t);return a[e][t]},h.getModuleCount=function(){return i},h.make=function(){u(!1,g())},h.createTableTag=function(e,t){e=e||2,t="undefined"===typeof t?4*e:t;let n="";n+='<table style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: "+t+"px;",n+='">',n+="<tbody>";for(let t=0;t<h.getModuleCount();t+=1){n+="<tr>";for(let s=0;s<h.getModuleCount();s+=1)n+='<td style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: 0px;",n+=" width: "+e+"px;",n+=" height: "+e+"px;",n+=" background-color: ",n+=h.isDark(t,s)?"#000000":"#ffffff",n+=";",n+='"/>';n+="</tr>"}return n+="</tbody>",n+="</table>",n},h.createImgTag=function(e,t,n,s,r){e=e||2,t="undefined"===typeof t?4*e:t;const o=t,a=h.getModuleCount()*e+t;return S(n,n,function(t,n){if(o<=t&&t<a&&o<=n&&n<a){const s=Math.floor((t-o)/e),r=Math.floor((n-o)/e);return h.isDark(r,s)?0:1}return 1},s,r)},h};u.stringToBytes=function(e){const t=[];for(let n=0;n<e.length;n+=1){const s=e.charCodeAt(n);t.push(255&s)}return t},u.createStringToBytes=function(e,t){const n=function(){const n=k(e),s=function(){const e=n.read();if(-1==e)throw new Error;return e};let r=0;const o={};while(1){const e=n.read();if(-1==e)break;const t=s(),a=s(),i=s(),l=String.fromCharCode(e<<8|t),c=a<<8|i;o[l]=c,r+=1}if(r!=t)throw new Error(r+" != "+t);return o}(),s="?".charCodeAt(0);return function(e){const t=[];for(let r=0;r<e.length;r+=1){const o=e.charCodeAt(r);if(o<128)t.push(o);else{const o=n[e.charAt(r)];"number"===typeof o?(255&o)==o?t.push(o):(t.push(o>>>8),t.push(255&o)):t.push(s)}}return t}};const f={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8};var d={L:1,M:0,Q:3,H:2};const g={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var p=function(){const e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],t=1335,n=7973,s=21522,r={},o=function(e){let t=0;while(0!=e)t+=1,e>>>=1;return t};return r.getBCHTypeInfo=function(e){let n=e<<10;while(o(n)-o(t)>=0)n^=t<<o(n)-o(t);return(e<<10|n)^s},r.getBCHTypeNumber=function(e){let t=e<<12;while(o(t)-o(n)>=0)t^=n<<o(t)-o(n);return e<<12|t},r.getPatternPosition=function(t){return e[t-1]},r.getMaskFunction=function(e){switch(e){case g.PATTERN000:return function(e,t){return(e+t)%2==0};case g.PATTERN001:return function(e){return e%2==0};case g.PATTERN010:return function(e,t){return t%3==0};case g.PATTERN011:return function(e,t){return(e+t)%3==0};case g.PATTERN100:return function(e,t){return(Math.floor(e/2)+Math.floor(t/3))%2==0};case g.PATTERN101:return function(e,t){return e*t%2+e*t%3==0};case g.PATTERN110:return function(e,t){return(e*t%2+e*t%3)%2==0};case g.PATTERN111:return function(e,t){return(e*t%3+(e+t)%2)%2==0};default:throw new Error("bad maskPattern:"+e)}},r.getErrorCorrectPolynomial=function(e){let t=w([1],0);for(let n=0;n<e;n+=1)t=t.multiply(w([1,m.gexp(n)],0));return t},r.getLengthInBits=function(e,t){if(t>=1&&t<10)switch(e){case f.MODE_NUMBER:return 10;case f.MODE_ALPHA_NUM:return 9;case f.MODE_8BIT_BYTE:return 8;case f.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case f.MODE_NUMBER:return 12;case f.MODE_ALPHA_NUM:return 11;case f.MODE_8BIT_BYTE:return 16;case f.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case f.MODE_NUMBER:return 14;case f.MODE_ALPHA_NUM:return 13;case f.MODE_8BIT_BYTE:return 16;case f.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},r.getLostPoint=function(e){const t=e.getModuleCount();let n=0;for(var s=0;s<t;s+=1)for(var r=0;r<t;r+=1){let o=0;const a=e.isDark(s,r);for(let n=-1;n<=1;n+=1)if(!(s+n<0||t<=s+n))for(let i=-1;i<=1;i+=1)r+i<0||t<=r+i||0==n&&0==i||a==e.isDark(s+n,r+i)&&(o+=1);o>5&&(n+=3+o-5)}for(s=0;s<t-1;s+=1)for(r=0;r<t-1;r+=1){let t=0;e.isDark(s,r)&&(t+=1),e.isDark(s+1,r)&&(t+=1),e.isDark(s,r+1)&&(t+=1),e.isDark(s+1,r+1)&&(t+=1),0!=t&&4!=t||(n+=3)}for(s=0;s<t;s+=1)for(r=0;r<t-6;r+=1)e.isDark(s,r)&&!e.isDark(s,r+1)&&e.isDark(s,r+2)&&e.isDark(s,r+3)&&e.isDark(s,r+4)&&!e.isDark(s,r+5)&&e.isDark(s,r+6)&&(n+=40);for(r=0;r<t;r+=1)for(s=0;s<t-6;s+=1)e.isDark(s,r)&&!e.isDark(s+1,r)&&e.isDark(s+2,r)&&e.isDark(s+3,r)&&e.isDark(s+4,r)&&!e.isDark(s+5,r)&&e.isDark(s+6,r)&&(n+=40);let o=0;for(r=0;r<t;r+=1)for(s=0;s<t;s+=1)e.isDark(s,r)&&(o+=1);const a=Math.abs(100*o/t/t-50)/5;return n+=10*a,n},r}(),m=function(){const e=new Array(256),t=new Array(256);for(var n=0;n<8;n+=1)e[n]=1<<n;for(n=8;n<256;n+=1)e[n]=e[n-4]^e[n-5]^e[n-6]^e[n-8];for(n=0;n<255;n+=1)t[e[n]]=n;const s={glog:function(e){if(e<1)throw new Error("glog("+e+")");return t[e]},gexp:function(t){while(t<0)t+=255;while(t>=256)t-=255;return e[t]}};return s}();function w(e,t){if("undefined"===typeof e.length)throw new Error(e.length+"/"+t);const n=function(){let n=0;while(n<e.length&&0==e[n])n+=1;const s=new Array(e.length-n+t);for(let t=0;t<e.length-n;t+=1)s[t]=e[t+n];return s}(),s={getAt:function(e){return n[e]},getLength:function(){return n.length},multiply:function(e){const t=new Array(s.getLength()+e.getLength()-1);for(let n=0;n<s.getLength();n+=1)for(let r=0;r<e.getLength();r+=1)t[n+r]^=m.gexp(m.glog(s.getAt(n))+m.glog(e.getAt(r)));return w(t,0)},mod:function(e){if(s.getLength()-e.getLength()<0)return s;const t=m.glog(s.getAt(0))-m.glog(e.getAt(0)),n=new Array(s.getLength());for(var r=0;r<s.getLength();r+=1)n[r]=s.getAt(r);for(r=0;r<e.getLength();r+=1)n[r]^=m.gexp(m.glog(e.getAt(r))+t);return w(n,0).mod(e)}};return s}var v=function(){const e=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t=function(e,t){const n={};return n.totalCount=e,n.dataCount=t,n},n={},s=function(t,n){switch(n){case d.L:return e[4*(t-1)+0];case d.M:return e[4*(t-1)+1];case d.Q:return e[4*(t-1)+2];case d.H:return e[4*(t-1)+3];default:return}};return n.getRSBlocks=function(e,n){const r=s(e,n);if("undefined"===typeof r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+n);const o=r.length/3,a=[];for(let e=0;e<o;e+=1){const n=r[3*e+0],s=r[3*e+1],o=r[3*e+2];for(let e=0;e<n;e+=1)a.push(t(s,o))}return a},n}(),x=function(){const e=[];let t=0;const n={getBuffer:function(){return e},getAt:function(t){const n=Math.floor(t/8);return 1==(e[n]>>>7-t%8&1)},put:function(e,t){for(let s=0;s<t;s+=1)n.putBit(1==(e>>>t-s-1&1))},getLengthInBits:function(){return t},putBit:function(n){const s=Math.floor(t/8);e.length<=s&&e.push(0),n&&(e[s]|=128>>>t%8),t+=1}};return n},y=function(e){const t=f.MODE_8BIT_BYTE,n=e;let s=[];const r={};for(let e=0,t=n.length;e<t;e++){const t=[],r=n.charCodeAt(e);r>65536?(t[0]=240|(1835008&r)>>>18,t[1]=128|(258048&r)>>>12,t[2]=128|(4032&r)>>>6,t[3]=128|63&r):r>2048?(t[0]=224|(61440&r)>>>12,t[1]=128|(4032&r)>>>6,t[2]=128|63&r):r>128?(t[0]=192|(1984&r)>>>6,t[1]=128|63&r):t[0]=r,s.push(t)}s=Array.prototype.concat.apply([],s),s.length!=n.length&&(s.unshift(191),s.unshift(187),s.unshift(239));const o=s;return r.getMode=function(){return t},r.getLength=function(){return o.length},r.write=function(e){for(let t=0;t<o.length;t+=1)e.put(o[t],8)},r};const b=function(){const e=[],t={writeByte:function(t){e.push(255&t)},writeShort:function(e){t.writeByte(e),t.writeByte(e>>>8)},writeBytes:function(e,n,s){n=n||0,s=s||e.length;for(let r=0;r<s;r+=1)t.writeByte(e[r+n])},writeString:function(e){for(let n=0;n<e.length;n+=1)t.writeByte(e.charCodeAt(n))},toByteArray:function(){return e},toString:function(){let t="";t+="[";for(let n=0;n<e.length;n+=1)n>0&&(t+=","),t+=e[n];return t+="]",t}};return t},N=function(){let e=0,t=0,n=0,s="";const r={},o=function(e){s+=String.fromCharCode(a(63&e))};var a=function(e){if(e<0);else{if(e<26)return 65+e;if(e<52)return e-26+97;if(e<62)return e-52+48;if(62==e)return 43;if(63==e)return 47}throw new Error("n:"+e)};return r.writeByte=function(s){e=e<<8|255&s,t+=8,n+=1;while(t>=6)o(e>>>t-6),t-=6},r.flush=function(){if(t>0&&(o(e<<6-t),e=0,t=0),n%3!=0){const e=3-n%3;for(let t=0;t<e;t+=1)s+="="}},r.toString=function(){return s},r};var k=function(e){const t=e;let n=0,s=0,r=0;const o={read:function(){while(r<8){if(n>=t.length){if(0==r)return-1;throw new Error("unexpected end of file./"+r)}const e=t.charAt(n);if(n+=1,"="==e)return r=0,-1;e.match(/^\s$/)||(s=s<<6|a(e.charCodeAt(0)),r+=6)}const e=s>>>r-8&255;return r-=8,e}};var a=function(e){if(e>=65&&e<=90)return e-65;if(e>=97&&e<=122)return e-97+26;if(e>=48&&e<=57)return e-48+52;if(43==e)return 62;if(47==e)return 63;throw new Error("c:"+e)};return o};const T=function(e,t){const n=e,s=t,r=new Array(e*t),o={setPixel:function(e,t,s){r[t*n+e]=s},write:function(e,t="#000000",r="#ffffff"){e.writeString("GIF87a"),e.writeShort(n),e.writeShort(s),e.writeByte(128),e.writeByte(0),e.writeByte(0);const o=t.split("");e.writeByte(parseInt(`${o[1]}${o[2]}`,16)),e.writeByte(parseInt(`${o[3]}${o[4]}`,16)),e.writeByte(parseInt(`${o[5]}${o[6]}`,16));const a=r.split("");e.writeByte(parseInt(`${a[1]}${a[2]}`,16)),e.writeByte(parseInt(`${a[3]}${a[4]}`,16)),e.writeByte(parseInt(`${a[5]}${a[6]}`,16)),e.writeString(","),e.writeShort(0),e.writeShort(0),e.writeShort(n),e.writeShort(s),e.writeByte(0);const l=2,c=i(l);e.writeByte(l);let h=0;while(c.length-h>255)e.writeByte(255),e.writeBytes(c,h,255),h+=255;e.writeByte(c.length-h),e.writeBytes(c,h,c.length-h),e.writeByte(0),e.writeString(";")}},a=function(e){const t=e;let n=0,s=0;const r={write:function(e,r){if(e>>>r!=0)throw new Error("length over");while(n+r>=8)t.writeByte(255&(e<<n|s)),r-=8-n,e>>>=8-n,s=0,n=0;s|=e<<n,n+=r},flush:function(){n>0&&t.writeByte(s)}};return r};var i=function(e){const t=1<<e,n=1+(1<<e);let s=e+1;const o=l();for(let e=0;e<t;e+=1)o.add(String.fromCharCode(e));o.add(String.fromCharCode(t)),o.add(String.fromCharCode(n));const i=b(),c=a(i);c.write(t,s);let h=0,u=String.fromCharCode(r[h]);h+=1;while(h<r.length){const e=String.fromCharCode(r[h]);h+=1,o.contains(u+e)?u+=e:(c.write(o.indexOf(u),s),o.size()<4095&&(o.size()==1<<s&&(s+=1),o.add(u+e)),u=e)}return c.write(o.indexOf(u),s),c.write(n,s),c.flush(),i.toByteArray()},l=function(){const e={};let t=0;const n={add:function(s){if(n.contains(s))throw new Error("dup key:"+s);e[s]=t,t+=1},size:function(){return t},indexOf:function(t){return e[t]},contains:function(t){return"undefined"!==typeof e[t]}};return n};return o};var S=function(e,t,n,s,r){const o=T(e,t);for(let s=0;s<t;s+=1)for(let t=0;t<e;t+=1)o.setPixel(t,s,n(t,s));const a=b();o.write(a,s,r);const i=N(),l=a.toByteArray();for(let e=0;e<l.length;e+=1)i.writeByte(l[e]);i.flush();let c="";return c+="data:image/gif;base64,",c+=i,c};const E=function(e,t){var n,s,r,o,a,i;t=null!==t&&void 0!==t?t:{};const l=null!==(n=t.typeNumber)&&void 0!==n?n:4,c=null!==(s=t.errorCorrectLevel)&&void 0!==s?s:"M",h=null!==(r=t.size)&&void 0!==r?r:500,f=null!==(o=t.black)&&void 0!==o?o:"#000000",d=null!==(a=t.white)&&void 0!==a?a:"#FFFFFF",g=null!==(i=t.padding)&&void 0!==i?i:4;let p;try{p=u(l,null!==c&&void 0!==c?c:"M"),p.addData(e),p.make()}catch(t){if(l>=40)throw new Error("Text too long to encode");return E(e,{size:h,errorCorrectLevel:c,typeNumber:l+1,black:f,white:d})}const m=void 0!==g?h-2*g:h,w=parseInt(""+m/p.getModuleCount()),v=w*p.getModuleCount(),x=void 0!==g?g:parseInt(""+(m-v)/2),y=v+2*x;return p.createImgTag(w,x,y,f,d)};var j=n(6529),C=n.n(j),M=n(4490)["URL"];const P=e=>{let t=null,n=null;const s=()=>new Promise((s,r)=>{const o=i().createSelectorQuery();o.select(`#${e}`).fields({node:!0,size:!0}).exec(e=>{e&&e[0]&&e[0].node?(t=e[0].node,n=t.getContext("2d"),s()):r(new Error("Canvas not found"))})}),r=e=>new Promise((n,s)=>{if(!t)return void s(new Error("Canvas not initialized"));const r=t.createImage();r.onload=()=>n(r),r.onerror=s,r.src=e}),o=async(e,s,r,o)=>{if(!t||!n)throw new Error("Canvas not initialized");let a=e.width,l=e.height;return r&&a>r&&(l=Math.round(r/a*l),a=r),o&&l>o&&(a=Math.round(o/l*a),l=o),t.width=a,t.height=l,n.clearRect(0,0,a,l),n.drawImage(e,0,0,a,l),new Promise((e,n)=>{i().canvasToTempFilePath({canvas:t,fileType:"jpg",quality:s,success:t=>e(t.tempFilePath),fail:n})})},a=async(e,s)=>{if(!t||!n)throw new Error("Canvas not initialized");return t.width=e.width,t.height=e.height,n.clearRect(0,0,e.width,e.height),n.drawImage(e,0,0),new Promise((e,n)=>{i().canvasToTempFilePath({canvas:t,fileType:s,success:t=>e(t.tempFilePath),fail:n})})},l=(e,t)=>{const n=String(e||"").split("\n"),s=[];for(const e of n){const n=e||"";if(t<=0||n.length<=t)s.push(n);else for(let e=0;e<n.length;e+=t)s.push(n.slice(e,e+t))}return s},c=(e,t)=>{const s=[],r=String(e||"").split("\n");for(const e of r){const r=e||"";let o="";for(const e of r){const r=o+e,a=n.measureText(r).width;a>t&&o?(s.push(o),o=e):o=r}s.push(o)}return s},h=async(e,s)=>{if(!t||!n)throw new Error("Canvas not initialized");const r=Math.max(10,Math.min(128,Math.round(s.fontSize||24))),o=Math.max(.05,Math.min(1,Number(s.opacity||1))),a=Math.max(0,Math.min(200,Math.round(s.padding||24)));t.width=e.width,t.height=e.height,n.clearRect(0,0,e.width,e.height),n.globalAlpha=1,n.drawImage(e,0,0),n.save(),n.globalAlpha=o,n.fillStyle=s.color||"#ffffff",n.textBaseline="top",n.textAlign="left",n.font=`800 ${r}px sans-serif`;const h=Math.max(10,e.width-2*a);let u=c(s.text||"",h);0===u.length&&(u=l("",1));const f=Math.round(1.25*r),d=u.length*f,g=Math.max(...u.map(e=>n.measureText(e).width)),p={tl:{x:a,y:a},tc:{x:(e.width-g)/2,y:a},tr:{x:e.width-a-g,y:a},cl:{x:a,y:(e.height-d)/2},cc:{x:(e.width-g)/2,y:(e.height-d)/2},cr:{x:e.width-a-g,y:(e.height-d)/2},bl:{x:a,y:e.height-a-d},bc:{x:(e.width-g)/2,y:e.height-a-d},br:{x:e.width-a-g,y:e.height-a-d}},m=p[s.position]||p.br,w=Math.max(a,Math.min(e.width-a-g,m.x)),v=Math.max(a,Math.min(e.height-a-d,m.y));n.shadowColor="rgba(0,0,0,0.35)",n.shadowBlur=Math.max(2,Math.round(r/6)),n.shadowOffsetX=0,n.shadowOffsetY=Math.max(1,Math.round(r/10));for(let e=0;e<u.length;e++){const t=u[e];n.fillText(t,w,v+e*f)}return n.restore(),new Promise((e,n)=>{i().canvasToTempFilePath({canvas:t,fileType:s.fileType,quality:"jpg"===s.fileType?s.quality??.92:void 0,success:t=>e(t.tempFilePath),fail:n})})},u=async(e,s)=>{if(!t||!n)throw new Error("Canvas not initialized");if(9!==e.length)throw new Error("Collage requires 9 images");const r=Math.max(0,s.margin||0),o=Math.max(100,...e.map(e=>Math.max(e.width,e.height))),a=3*o+4*r;t.width=a,t.height=a,n.clearRect(0,0,a,a),s.bgColor&&(n.fillStyle=s.bgColor,n.fillRect(0,0,a,a));for(let t=0;t<9;t++){const s=Math.floor(t/3),a=t%3,i=e[t],l=a*(o+r)+r,c=s*(o+r)+r,h=i.width/i.height;let u=o,f=o;h>1?f=o/h:u=o*h;const d=l+(o-u)/2,g=c+(o-f)/2;n.drawImage(i,d,g,u,f)}return new Promise((e,n)=>{i().canvasToTempFilePath({canvas:t,fileType:s.fileType,quality:"jpg"===s.fileType?s.quality??.92:void 0,success:t=>e(t.tempFilePath),fail:n})})},f=async e=>{if(!t||!n)throw new Error("Canvas not initialized");const s=Math.max(100,Math.min(1e3,e.size||200));t.width=s,t.height=s,n.clearRect(0,0,s,s);const o=E(e.text,{size:s,black:e.color,white:e.bgColor}),a=await r(o);return n.drawImage(a,0,0,s,s),new Promise((n,s)=>{i().canvasToTempFilePath({canvas:t,fileType:e.fileType,quality:"jpg"===e.fileType?e.quality??.92:void 0,success:e=>n(e.tempFilePath),fail:s})})},d=async(e,s)=>{if(!t||!n)throw new Error("Canvas not initialized");return new Promise((t,n)=>{const r=new(C())({workers:2,quality:s.quality,width:s.width,height:s.height});e.forEach(e=>{r.addFrame(e,{delay:s.delay})}),r.on("finished",e=>{const s=M.createObjectURL(e),r=`${i().env.USER_DATA_PATH}/${Date.now()}.gif`;i().downloadFile({url:s,filePath:r,success:()=>t(r),fail:n})}),r.render()})},g=async(e,s)=>{if(!t||!n)throw new Error("Canvas not initialized");const r=Math.max(100,Math.min(1e3,s.size||200));t.width=r,t.height=r,n.clearRect(0,0,r,r);const o=Math.min(e.width,e.height),a=(e.width-o)/2,l=(e.height-o)/2;return n.save(),"circle"===s.shape&&(n.beginPath(),n.arc(r/2,r/2,r/2,0,2*Math.PI),n.clip()),n.drawImage(e,a,l,o,o,0,0,r,r),n.restore(),s.borderWidth>0&&(n.strokeStyle=s.borderColor||"#ffffff",n.lineWidth=s.borderWidth,"circle"===s.shape?(n.beginPath(),n.arc(r/2,r/2,r/2-s.borderWidth/2,0,2*Math.PI),n.stroke()):n.strokeRect(0,0,r,r)),new Promise((e,n)=>{i().canvasToTempFilePath({canvas:t,fileType:s.fileType,quality:"jpg"===s.fileType?s.quality??.92:void 0,success:t=>e(t.tempFilePath),fail:n})})},p=async(e,s)=>{if(!t||!n)throw new Error("Canvas not initialized");if(e.length<2)throw new Error("Stitching requires at least 2 images");const r=Math.max(0,s.spacing||0),o=Math.max(...e.map(e=>e.width)),a=e.reduce((e,t)=>e+t.height,0)+r*(e.length-1);t.width=o,t.height=a,n.clearRect(0,0,o,a);let l=0;for(const t of e){const e=(o-t.width)/2;n.drawImage(t,e,l),l+=t.height+r}return new Promise((e,n)=>{i().canvasToTempFilePath({canvas:t,fileType:s.fileType,quality:"jpg"===s.fileType?s.quality??.92:void 0,success:t=>e(t.tempFilePath),fail:n})})},m=async(e,s)=>{if(!t||!n)throw new Error("Canvas not initialized");const r=Math.max(200,Math.min(512,Math.max(e.width,e.height)));t.width=r,t.height=r,n.clearRect(0,0,r,r);const o=e.width/e.height;let a=r,l=r;o>1?l=r/o:a=r*o;const c=(r-a)/2,h=(r-l)/2;if(n.drawImage(e,c,h,a,l),s.text){const e=Math.max(24,Math.round(r/8));n.font=`900 ${e}px sans-serif`,n.textAlign="center",n.textBaseline="middle",n.fillStyle="#ffffff",n.strokeStyle="#000000",n.lineWidth=Math.max(2,Math.round(e/10));const t=s.text.split("\n"),o=r-t.length*e*1.2;for(let s=0;s<t.length;s++){const a=t[s],i=o+s*e*1.2;n.strokeText(a,r/2,i),n.fillText(a,r/2,i)}}return new Promise((e,n)=>{i().canvasToTempFilePath({canvas:t,fileType:s.fileType,quality:"jpg"===s.fileType?s.quality??.92:void 0,success:t=>e(t.tempFilePath),fail:n})})};return{init:s,loadImage:r,compress:o,convert:a,addText:h,collage:u,generateQrCode:f,createGif:d,createAvatar:g,stitchImages:p,createSticker:m}};var _=n(2338);const A={compress:{title:"\u56fe\u7247\u538b\u7f29",desc:"\u964d\u4f4e\u4f53\u79ef\uff0c\u5c3d\u91cf\u4fdd\u6301\u6e05\u6670"},convert:{title:"\u56fe\u7247\u683c\u5f0f\u8f6c\u6362",desc:"JPG/PNG \u4e92\u8f6c"},text:{title:"\u56fe\u7247\u52a0\u6587\u5b57",desc:"\u6dfb\u52a0\u6c34\u5370\u6216\u8bf4\u660e\u6587\u5b57"},format:{title:"\u56fe\u7247\u683c\u5f0f",desc:"\u67e5\u770b\u56fe\u7247\u57fa\u672c\u4fe1\u606f"},collage:{title:"\u4e5d\u5bab\u683c\u62fc\u56fe",desc:"\u9009\u62e9 9 \u5f20\u56fe\uff0c\u751f\u6210 3x3 \u62fc\u56fe"},qrcode:{title:"\u4e8c\u7ef4\u7801\u751f\u6210",desc:"\u8f93\u5165\u6587\u672c\u6216\u94fe\u63a5\uff0c\u751f\u6210\u4e8c\u7ef4\u7801\u56fe\u7247"},gif:{title:"GIF \u56fe\u5236\u4f5c",desc:"\u591a\u56fe\u5408\u6210\u52a8\u56fe"},avatar:{title:"\u5934\u50cf\u5236\u4f5c",desc:"\u88c1\u526a\u5934\u50cf\u5e76\u52a0\u8fb9\u6846"},"long-image":{title:"\u957f\u56fe\u62fc\u63a5",desc:"\u591a\u56fe\u7eb5\u5411\u5408\u6210"},sticker:{title:"\u8868\u60c5\u5305",desc:"\u52a0\u5b57\u751f\u6210\u8868\u60c5\u5305"}},I=()=>{const e=(0,a.useRouter)(),t=e.params?.tool||"compress",n=A[t],s=(0,r.useRef)(null),[c,u]=(0,r.useState)(!1),[f,d]=(0,r.useState)(!1),[g,p]=(0,r.useState)([]),[m,w]=(0,r.useState)(""),[v,x]=(0,r.useState)(0),[y,b]=(0,r.useState)(80),[N,k]=(0,r.useState)("none"),[T,S]=(0,r.useState)(0),[E,j]=(0,r.useState)("jpg"),[C,M]=(0,r.useState)(""),[I,B]=(0,r.useState)(36),[L,F]=(0,r.useState)(90),[D,z]=(0,r.useState)(24),[Y,R]=(0,r.useState)("#ffffff"),[O,q]=(0,r.useState)("br"),[W,$]=(0,r.useState)(4),[U,H]=(0,r.useState)("#ffffff"),[G,J]=(0,r.useState)(""),[K,Q]=(0,r.useState)(200),[V,X]=(0,r.useState)("#111827"),[Z,ee]=(0,r.useState)("#ffffff"),[te,ne]=(0,r.useState)(200),[se,re]=(0,r.useState)(10),[oe,ae]=(0,r.useState)(200),[ie,le]=(0,r.useState)("circle"),[ce,he]=(0,r.useState)(4),[ue,fe]=(0,r.useState)("#ffffff"),[de,ge]=(0,r.useState)(0),[pe,me]=(0,r.useState)(""),we=n?.title||"\u529f\u80fd\u9875",ve=n?.desc||"\u8bf7\u4ece\u9996\u9875\u8fdb\u5165",xe=(0,r.useMemo)(()=>!A[t],[t]);(0,r.useEffect)(()=>{xe&&i().showToast({title:"\u672a\u627e\u5230\u529f\u80fd",icon:"none"})},[xe]),(0,r.useEffect)(()=>{i().setNavigationBarTitle({title:we})},[we]),(0,r.useEffect)(()=>{let e=!0;const t=async()=>{try{s.current=P("toolsCanvas"),await s.current.init(),e&&u(!0)}catch(t){e&&u(!1),i().showToast({title:"\u521d\u59cb\u5316\u5931\u8d25",icon:"none"})}};return t(),()=>{e=!1}},[]);const ye=()=>{w(""),x(0)},be=async()=>{if(m)try{await i().saveImageToPhotosAlbum({filePath:m}),i().showToast({title:"\u5df2\u4fdd\u5b58\u5230\u76f8\u518c",icon:"success"})}catch(e){if(String(e?.errMsg||"").includes("cancel"))return;i().showToast({title:"\u4fdd\u5b58\u5931\u8d25",icon:"none"})}},Ne=async()=>{if(0!==g.length&&s.current)if(c){d(!0);try{const e="width"===N?T:void 0,t="height"===N?T:void 0,n=await s.current.compress(g[0].img,y/100,e,t),r=await i().getFileInfo({filePath:n});w(n),x(r.size),i().showToast({title:`\u5904\u7406\u5b8c\u6210 ${g.length} \u5f20\u56fe\u7247`,icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}else i().showToast({title:"\u521d\u59cb\u5316\u4e2d",icon:"none"})},ke=async()=>{if(0!==g.length&&s.current)if(c){d(!0);try{const e=await Promise.all(g.map(async e=>{const t=await s.current.convert(e.img,E),n=await i().getFileInfo({filePath:t});return{path:t,size:n.size}})),t=e[0];w(t.path),x(t.size),i().showToast({title:`\u5904\u7406\u5b8c\u6210 ${g.length} \u5f20\u56fe\u7247`,icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}else i().showToast({title:"\u521d\u59cb\u5316\u4e2d",icon:"none"})},Te=async()=>{if(9===g.length){if(s.current){d(!0);try{const e=await s.current.collage(g.map(e=>e.img),{margin:W,bgColor:U,fileType:"jpg"}),t=await i().getFileInfo({filePath:e});w(e),x(t.size),i().showToast({title:"\u5904\u7406\u5b8c\u6210",icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}}else i().showToast({title:"\u8bf7\u9009\u62e9 9 \u5f20\u56fe\u7247",icon:"none"})},Se=async()=>{if(G.trim()){if(s.current){d(!0);try{const e=await s.current.generateQrCode({text:G,size:K,color:V,bgColor:Z,fileType:"png"}),t=await i().getFileInfo({filePath:e});w(e),x(t.size),i().showToast({title:"\u5904\u7406\u5b8c\u6210",icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}}else i().showToast({title:"\u8bf7\u8f93\u5165\u6587\u672c",icon:"none"})},Ee=async()=>{if(g.length<2)i().showToast({title:"\u8bf7\u9009\u62e9\u81f3\u5c11 2 \u5f20\u56fe\u7247",icon:"none"});else if(s.current){d(!0);try{const e=await s.current.createGif(g.map(e=>e.img),{width:g[0].width,height:g[0].height,delay:te,quality:se}),t=await i().getFileInfo({filePath:e});w(e),x(t.size),i().showToast({title:"\u5904\u7406\u5b8c\u6210",icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}},je=async()=>{if(0!==g.length){if(s.current){d(!0);try{const e=await s.current.createAvatar(g[0].img,{size:oe,shape:ie,borderWidth:ce,borderColor:ue,fileType:"png"}),t=await i().getFileInfo({filePath:e});w(e),x(t.size),i().showToast({title:"\u5904\u7406\u5b8c\u6210",icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}}else i().showToast({title:"\u8bf7\u9009\u62e9\u4e00\u5f20\u56fe\u7247",icon:"none"})},Ce=async()=>{if(g.length<2)i().showToast({title:"\u8bf7\u9009\u62e9\u81f3\u5c11 2 \u5f20\u56fe\u7247",icon:"none"});else if(s.current){d(!0);try{const e=await s.current.stitchImages(g.map(e=>e.img),{spacing:de,fileType:"jpg"}),t=await i().getFileInfo({filePath:e});w(e),x(t.size),i().showToast({title:"\u5904\u7406\u5b8c\u6210",icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}},Me=async()=>{if(0!==g.length){if(s.current){d(!0);try{const e=await s.current.createSticker(g[0].img,{text:pe,fileType:"png"}),t=await i().getFileInfo({filePath:e});w(e),x(t.size),i().showToast({title:"\u5904\u7406\u5b8c\u6210",icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}}else i().showToast({title:"\u8bf7\u9009\u62e9\u4e00\u5f20\u56fe\u7247",icon:"none"})},Pe=async()=>{if(0!==g.length&&s.current)if(c)if(String(C||"").trim()){d(!0);try{const e={text:C,fontSize:I,color:Y,opacity:L/100,position:O,padding:D,fileType:"png"},t=await Promise.all(g.map(async t=>{const n=await s.current.addText(t.img,e),r=await i().getFileInfo({filePath:n});return{path:n,size:r.size}})),n=t[0];w(n.path),x(n.size),i().showToast({title:`\u5904\u7406\u5b8c\u6210 ${g.length} \u5f20\u56fe\u7247`,icon:"success"})}catch(e){i().showToast({title:"\u5904\u7406\u5931\u8d25",icon:"none"})}finally{d(!1)}}else i().showToast({title:"\u8bf7\u8f93\u5165\u6587\u5b57",icon:"none"});else i().showToast({title:"\u521d\u59cb\u5316\u4e2d",icon:"none"})};return(0,l.jsxs)(o.Ss,{className:"tools-page",children:[(0,l.jsx)(_.A,{title:we,showBack:!0}),(0,l.jsx)(o.Hl,{id:"toolsCanvas",canvasId:"toolsCanvas",type:"2d",style:{width:"0px",height:"0px",position:"fixed",left:"-9999px"}}),(0,l.jsxs)(o.Ss,{className:"tools-content",children:[(0,l.jsxs)(o.Ss,{className:"tools-header",children:[(0,l.jsx)(o.EY,{className:"tools-title",children:we}),(0,l.jsx)(o.EY,{className:"tools-desc",children:ve})]}),(0,l.jsx)(o.Ss,{className:"tools-card",children:(0,l.jsx)(h,{images:g.map(e=>({path:e.path,size:e.size})),onImagesChange:e=>{s.current&&Promise.all(e.map(async e=>{const t=await s.current.loadImage(e.path),n=e.path.split(".").pop()||"unknown";return{...e,img:t,width:t.width,height:t.height,type:n}})).then(e=>{p(e),ye()})},maxCount:"collage"===t?9:"gif"===t||"long-image"===t?20:1,disabled:f})}),m&&(0,l.jsxs)(o.Ss,{className:"tools-card tools-result-card",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u5904\u7406\u7ed3\u679c"}),(0,l.jsxs)(o.Ss,{className:"tools-result-preview",children:[(0,l.jsx)(o._V,{className:"tools-result-image",src:m,mode:"aspectFit"}),(0,l.jsxs)(o.EY,{className:"tools-meta",children:[(v/1024).toFixed(1)," KB"]})]})]}),"compress"===t&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u8d28\u91cf: ",y,"%"]}),(0,l.jsx)(o.Ap,{value:y,min:10,max:100,step:1,blockSize:12,onChanging:e=>b(e.detail.value),disabled:f}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u8c03\u6574\u5c3a\u5bf8"}),(0,l.jsx)(o.Ss,{className:"tools-btn-row",children:[{k:"none",t:"\u4e0d\u8c03\u6574"},{k:"width",t:"\u6309\u5bbd\u5ea6"},{k:"height",t:"\u6309\u9ad8\u5ea6"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-option-btn "+(N===e.k?"active":""),onClick:()=>k(e.k),children:(0,l.jsx)(o.EY,{className:"tools-option-text",children:e.t})},e.k))})]}),"none"!==N&&(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"width"===N?"\u5bbd\u5ea6 (px)":"\u9ad8\u5ea6 (px)"}),(0,l.jsx)(o.pd,{className:"tools-input",type:"number",value:String(T||""),placeholder:"\u8f93\u5165\u50cf\u7d20\u503c",onInput:e=>S(Number(e.detail.value)),disabled:f})]})]}),"convert"===t&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u76ee\u6807\u683c\u5f0f"}),(0,l.jsx)(o.Ss,{className:"tools-btn-row",children:[{k:"jpg",t:"JPG"},{k:"png",t:"PNG"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-option-btn "+(E===e.k?"active":""),onClick:()=>j(e.k),children:(0,l.jsx)(o.EY,{className:"tools-option-text",children:e.t})},e.k))}),"jpg"===E&&(0,l.jsx)(o.EY,{className:"tools-tip",children:"PNG \u8f6c JPG \u65f6\u900f\u660e\u80cc\u666f\u5c06\u53d8\u4e3a\u767d\u8272"})]}),"text"===t&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u6587\u5b57\u5185\u5bb9"}),(0,l.jsx)(o.TM,{className:"tools-textarea",value:C,placeholder:"\u8f93\u5165\u4f60\u8981\u6dfb\u52a0\u7684\u6587\u5b57\uff08\u652f\u6301\u6362\u884c\uff09",maxlength:200,onInput:e=>M(e.detail.value),disabled:f,autoHeight:!0}),(0,l.jsxs)(o.Ss,{children:[(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u5927\u5c0f: ",I,"px"]}),(0,l.jsx)(o.Ap,{value:I,min:12,max:96,step:1,blockSize:12,onChanging:e=>B(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u900f\u660e\u5ea6: ",L,"%"]}),(0,l.jsx)(o.Ap,{value:L,min:10,max:100,step:1,blockSize:12,onChanging:e=>F(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u8fb9\u8ddd: ",D,"px"]}),(0,l.jsx)(o.Ap,{value:D,min:0,max:80,step:1,blockSize:12,onChanging:e=>z(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u989c\u8272"}),(0,l.jsx)(o.Ss,{className:"tools-color-row",children:[{label:"\u767d",value:"#ffffff"},{label:"\u9ed1",value:"#111827"},{label:"\u7ea2",value:"#ef4444"},{label:"\u6a59",value:"#f97316"},{label:"\u9ec4",value:"#f59e0b"},{label:"\u7eff",value:"#22c55e"},{label:"\u9752",value:"#06b6d4"},{label:"\u84dd",value:"#3b82f6"},{label:"\u7d2b",value:"#8b5cf6"},{label:"\u7c89",value:"#ec4899"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-color-swatch "+(Y===e.value?"active":""),style:{background:e.value},onClick:()=>R(e.value)},e.value))})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u4f4d\u7f6e"}),(0,l.jsx)(o.Ss,{className:"tools-pos-grid",children:[{k:"tl",t:"\u5de6\u4e0a"},{k:"tc",t:"\u4e2d\u4e0a"},{k:"tr",t:"\u53f3\u4e0a"},{k:"cl",t:"\u5de6\u4e2d"},{k:"cc",t:"\u6b63\u4e2d"},{k:"cr",t:"\u53f3\u4e2d"},{k:"bl",t:"\u5de6\u4e0b"},{k:"bc",t:"\u4e2d\u4e0b"},{k:"br",t:"\u53f3\u4e0b"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-pos "+(O===e.k?"active":""),onClick:()=>q(e.k),children:(0,l.jsx)(o.EY,{className:"tools-pos-text",children:e.t})},e.k))})]})]})]}),"format"===t&&g.length>0&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u56fe\u7247\u4fe1\u606f (\u7b2c 1 \u5f20)"}),(0,l.jsxs)(o.Ss,{className:"tools-info-grid",children:[(0,l.jsx)(o.EY,{className:"tools-info-key",children:"\u683c\u5f0f"}),(0,l.jsx)(o.EY,{className:"tools-info-value",children:g[0].type.toUpperCase()}),(0,l.jsx)(o.EY,{className:"tools-info-key",children:"\u5c3a\u5bf8"}),(0,l.jsxs)(o.EY,{className:"tools-info-value",children:[g[0].width," x ",g[0].height]}),(0,l.jsx)(o.EY,{className:"tools-info-key",children:"\u5927\u5c0f"}),(0,l.jsxs)(o.EY,{className:"tools-info-value",children:[(g[0].size/1024).toFixed(1)," KB"]})]})]}),"collage"===t&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u8fb9\u8ddd: ",W,"px"]}),(0,l.jsx)(o.Ap,{value:W,min:0,max:40,step:1,blockSize:12,onChanging:e=>$(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u80cc\u666f\u8272"}),(0,l.jsx)(o.Ss,{className:"tools-color-row",children:[{label:"\u767d",value:"#ffffff"},{label:"\u9ed1",value:"#111827"},{label:"\u7ea2",value:"#ef4444"},{label:"\u6a59",value:"#f97316"},{label:"\u9ec4",value:"#f59e0b"},{label:"\u7eff",value:"#22c55e"},{label:"\u9752",value:"#06b6d4"},{label:"\u84dd",value:"#3b82f6"},{label:"\u7d2b",value:"#8b5cf6"},{label:"\u7c89",value:"#ec4899"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-color-swatch "+(U===e.value?"active":""),style:{background:e.value},onClick:()=>H(e.value)},e.value))})]})]}),"compress"!==t&&"convert"!==t&&"text"!==t&&"format"!==t&&"collage"!==t&&"qrcode"!==t&&"gif"!==t&&"avatar"!==t&&"long-image"!==t&&"sticker"!==t&&(0,l.jsx)(o.Ss,{className:"tools-card",children:(0,l.jsx)(o.EY,{className:"tools-tip",children:"\u8be5\u529f\u80fd\u5f85\u5b9e\u73b0\uff0c\u5148\u5b8c\u6210\u4e3b\u529f\u80fd\u95ed\u73af\u3002"})}),"sticker"===t&&(0,l.jsx)(o.Ss,{className:"tools-card",children:(0,l.jsx)(o.TM,{className:"tools-textarea",value:pe,placeholder:"\u8f93\u5165\u8868\u60c5\u5305\u6587\u5b57",maxlength:100,onInput:e=>me(e.detail.value),disabled:f,autoHeight:!0})}),"long-image"===t&&(0,l.jsx)(o.Ss,{className:"tools-card",children:(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u95f4\u8ddd: ",de,"px"]}),(0,l.jsx)(o.Ap,{value:de,min:0,max:40,step:1,blockSize:12,onChanging:e=>ge(e.detail.value),disabled:f})]})}),"avatar"===t&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u5f62\u72b6"}),(0,l.jsx)(o.Ss,{className:"tools-btn-row",children:[{k:"circle",t:"\u5706\u5f62"},{k:"square",t:"\u65b9\u5f62"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-option-btn "+(ie===e.k?"active":""),onClick:()=>le(e.k),children:(0,l.jsx)(o.EY,{className:"tools-option-text",children:e.t})},e.k))})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u5c3a\u5bf8: ",oe,"px"]}),(0,l.jsx)(o.Ap,{value:oe,min:100,max:800,step:10,blockSize:12,onChanging:e=>ae(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u8fb9\u6846: ",ce,"px"]}),(0,l.jsx)(o.Ap,{value:ce,min:0,max:40,step:1,blockSize:12,onChanging:e=>he(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u8fb9\u6846\u989c\u8272"}),(0,l.jsx)(o.Ss,{className:"tools-color-row",children:[{label:"\u767d",value:"#ffffff"},{label:"\u9ed1",value:"#111827"},{label:"\u7ea2",value:"#ef4444"},{label:"\u6a59",value:"#f97316"},{label:"\u9ec4",value:"#f59e0b"},{label:"\u7eff",value:"#22c55e"},{label:"\u9752",value:"#06b6d4"},{label:"\u84dd",value:"#3b82f6"},{label:"\u7d2b",value:"#8b5cf6"},{label:"\u7c89",value:"#ec4899"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-color-swatch "+(ue===e.value?"active":""),style:{background:e.value},onClick:()=>fe(e.value)},e.value))})]})]}),"gif"===t&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u5ef6\u8fdf: ",te,"ms"]}),(0,l.jsx)(o.Ap,{value:te,min:50,max:1e3,step:10,blockSize:12,onChanging:e=>ne(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u8d28\u91cf: ",se]}),(0,l.jsx)(o.Ap,{value:se,min:1,max:20,step:1,blockSize:12,onChanging:e=>re(e.detail.value),disabled:f})]})]}),"qrcode"===t&&(0,l.jsxs)(o.Ss,{className:"tools-card",children:[(0,l.jsx)(o.TM,{className:"tools-textarea",value:G,placeholder:"\u8f93\u5165\u6587\u672c\u6216\u94fe\u63a5",maxlength:500,onInput:e=>J(e.detail.value),disabled:f,autoHeight:!0}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsxs)(o.EY,{className:"tools-label",children:["\u5c3a\u5bf8: ",K,"px"]}),(0,l.jsx)(o.Ap,{value:K,min:100,max:800,step:10,blockSize:12,onChanging:e=>Q(e.detail.value),disabled:f})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u524d\u666f\u8272"}),(0,l.jsx)(o.Ss,{className:"tools-color-row",children:[{label:"\u9ed1",value:"#111827"},{label:"\u767d",value:"#ffffff"},{label:"\u7ea2",value:"#ef4444"},{label:"\u6a59",value:"#f97316"},{label:"\u9ec4",value:"#f59e0b"},{label:"\u7eff",value:"#22c55e"},{label:"\u9752",value:"#06b6d4"},{label:"\u84dd",value:"#3b82f6"},{label:"\u7d2b",value:"#8b5cf6"},{label:"\u7c89",value:"#ec4899"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-color-swatch "+(V===e.value?"active":""),style:{background:e.value},onClick:()=>X(e.value)},e.value))})]}),(0,l.jsxs)(o.Ss,{className:"tools-row",children:[(0,l.jsx)(o.EY,{className:"tools-label",children:"\u80cc\u666f\u8272"}),(0,l.jsx)(o.Ss,{className:"tools-color-row",children:[{label:"\u767d",value:"#ffffff"},{label:"\u9ed1",value:"#111827"},{label:"\u7ea2",value:"#ef4444"},{label:"\u6a59",value:"#f97316"},{label:"\u9ec4",value:"#f59e0b"},{label:"\u7eff",value:"#22c55e"},{label:"\u9752",value:"#06b6d4"},{label:"\u84dd",value:"#3b82f6"},{label:"\u7d2b",value:"#8b5cf6"},{label:"\u7c89",value:"#ec4899"}].map(e=>(0,l.jsx)(o.Ss,{className:"tools-color-swatch "+(Z===e.value?"active":""),style:{background:e.value},onClick:()=>ee(e.value)},e.value))})]})]}),!c&&(0,l.jsx)(o.EY,{className:"tools-tip",children:"\u521d\u59cb\u5316\u4e2d\u2026"}),f&&(0,l.jsx)(o.EY,{className:"tools-tip",children:"\u5904\u7406\u4e2d\u2026"})]}),(0,l.jsxs)(o.Ss,{className:"tools-footer",children:[(0,l.jsx)(o.$n,{className:"tools-footer-btn primary",onClick:()=>{"compress"===t?Ne():"convert"===t?ke():"text"===t?Pe():"collage"===t?Te():"qrcode"===t?Se():"gif"===t?Ee():"avatar"===t?je():"long-image"===t?Ce():"sticker"===t&&Me()},disabled:f||"qrcode"!==t&&0===g.length,children:f?"\u5904\u7406\u4e2d...":"compress"===t?"\u5f00\u59cb\u538b\u7f29":"convert"===t?"\u5f00\u59cb\u8f6c\u6362":"text"===t?"\u751f\u6210\u56fe\u7247":"collage"===t?"\u5f00\u59cb\u62fc\u56fe":"qrcode"===t?"\u751f\u6210\u4e8c\u7ef4\u7801":"gif"===t?"\u751f\u6210 GIF":"avatar"===t?"\u751f\u6210\u5934\u50cf":"long-image"===t?"\u5f00\u59cb\u62fc\u63a5":"sticker"===t?"\u751f\u6210\u8868\u60c5\u5305":"\u751f\u6210"}),m&&(0,l.jsx)(o.$n,{className:"tools-footer-btn secondary",onClick:be,disabled:f,children:"\u4e0b\u8f7d\u56fe\u7247"})]})]})};var B=I,L={navigationBarTitleText:"",navigationStyle:"custom"},F=(0,s.eU)(B,"pages/tools/index",{root:{cn:[]}},L||{});B&&B.behaviors&&(F.behaviors=(F.behaviors||[]).concat(B.behaviors));Page(F)},6529:function(e,t,n){var s=n(4490)["navigator"],r=n(4490)["document"];(function(t){e.exports=t()})(function(){return function e(t,n,s){function r(a,i){if(!n[a]){if(!t[a]){var l=void 0;if(!i&&l)return require(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[a]={exports:{}};t[a][0].call(h.exports,function(e){var n=t[a][1][e];return r(n||e)},h,h.exports,e,t,n,s)}return n[a].exports}for(var o=void 0,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(e,t,n){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"===typeof e}function o(e){return"number"===typeof e}function a(e){return"object"===typeof e&&null!==e}function i(e){return void 0===e}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,n,s,o,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(n=this._events[e],i(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(a(n))for(o=Array.prototype.slice.call(arguments,1),c=n.slice(),s=c.length,l=0;l<s;l++)c[l].apply(this,o);return!0},s.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(n=i(this._maxListeners)?s.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function s(){this.removeListener(e,s),n||(n=!0,t.apply(this,arguments))}return s.listener=t,this.on(e,s),this},s.prototype.removeListener=function(e,t){var n,s,o,i;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,s=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(i=o;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){s=i;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)while(n.length)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){var o,a,i,l,c;c=s.userAgent.toLowerCase(),l=s.platform.toLowerCase(),o=c.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],i="ie"===o[1]&&r.documentMode,a={name:"version"===o[1]?o[3]:o[1],version:i||parseFloat("opera"===o[1]&&o[4]?o[4]:o[2]),platform:{name:c.match(/ip(?:ad|od|hone)/)?"ios":(c.match(/(?:webos|android)/)||l.match(/mac|win|linux/)||["other"])[0]}},a[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,t.exports=a},{}],3:[function(e,t,n){var s,o,a,i=function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function s(){this.constructor=e}return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},l={}.hasOwnProperty,c=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},h=[].slice;s=e("events").EventEmitter,a=e("./browser.coffee"),o=function(e){var t,n;function s(e){var n,s,r;for(s in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),t)r=t[s],null==(n=this.options)[s]&&(n[s]=r)}return i(s,e),t={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},n={delay:500,copy:!1},s.prototype.setOption=function(e,t){if(this.options[e]=t,null!=this._canvas&&("width"===e||"height"===e))return this._canvas[e]=t},s.prototype.setOptions=function(e){var t,n,s;for(t in n=[],e)l.call(e,t)&&(s=e[t],n.push(this.setOption(t,s)));return n},s.prototype.addFrame=function(e,t){var s,r;for(r in null==t&&(t={}),s={},s.transparent=this.options.transparent,n)s[r]=t[r]||n[r];if(null==this.options.width&&this.setOption("width",e.width),null==this.options.height&&this.setOption("height",e.height),"undefined"!==typeof ImageData&&null!==ImageData&&e instanceof ImageData)s.data=e.data;else if("undefined"!==typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?s.data=this.getContextData(e):s.context=e;else{if(null==e.childNodes)throw new Error("Invalid image");t.copy?s.data=this.getImageData(e):s.image=e}return this.frames.push(s)},s.prototype.render=function(){var e,t,n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var e,t,n;for(n=[],e=0,t=this.frames.length;0<=t?e<t:e>t;0<=t?++e:--e)n.push(null);return n}.call(this),t=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(e=0,n=t;0<=n?e<n:e>n;0<=n?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},s.prototype.abort=function(){var e;while(1){if(e=this.activeWorkers.shift(),null==e)break;this.log("killing active worker"),e.terminate()}return this.running=!1,this.emit("abort")},s.prototype.spawnWorkers=function(){var e,t,n;return e=Math.min(this.options.workers,this.frames.length),function(){n=[];for(var s=t=this.freeWorkers.length;t<=e?s<e:s>e;t<=e?s++:s--)n.push(s);return n}.apply(this).forEach(function(e){return function(t){var n;return e.log("spawning worker "+t),n=new Worker(e.options.workerScript),n.onmessage=function(t){return e.activeWorkers.splice(e.activeWorkers.indexOf(n),1),e.freeWorkers.push(n),e.frameFinished(t.data)},e.freeWorkers.push(n)}}(this)),e},s.prototype.frameFinished=function(e){var t,n;if(this.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,!0===this.options.globalPalette&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(t=1,n=this.freeWorkers.length;1<=n?t<n:t>n;1<=n?++t:--t)this.renderNextFrame();return c.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},s.prototype.finishRendering=function(){var e,t,n,s,r,o,a,i,l,c,h,u,f,d,g,p;for(i=0,d=this.imageParts,r=0,l=d.length;r<l;r++)t=d[r],i+=(t.data.length-1)*t.pageSize+t.cursor;for(i+=t.pageSize-t.cursor,this.log("rendering finished - filesize "+Math.round(i/1e3)+"kb"),e=new Uint8Array(i),u=0,g=this.imageParts,o=0,c=g.length;o<c;o++)for(t=g[o],p=t.data,n=a=0,h=p.length;a<h;n=++a)f=p[n],e.set(f,u),n===t.data.length-1?u+=t.cursor:u+=t.pageSize;return s=new Blob([e],{type:"image/gif"}),this.emit("finished",s,e)},s.prototype.renderNextFrame=function(){var e,t,n;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),t=this.getTask(e),this.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(t)},s.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},s.prototype.getImageData=function(e){var t;return null==this._canvas&&(this._canvas=r.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),t=this._canvas.getContext("2d"),t.setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},s.prototype.getTask=function(e){var t,n;if(t=this.frames.indexOf(e),n={index:t,last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===a.name},null!=e.data)n.data=e.data;else if(null!=e.context)n.data=this.getContextData(e.context);else{if(null==e.image)throw new Error("Invalid frame");n.data=this.getImageData(e.image)}return n},s.prototype.log=function(){var e;if(e=1<=arguments.length?h.call(arguments,0):[],this.options.debug)return console.log.apply(console,e)},s}(s),t.exports=o},{"./browser.coffee":2,events:1}]},{},[3])(3)})}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[907,96,76],function(){return t(4354)});e.O()}]);