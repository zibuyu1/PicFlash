{"version":3,"file":"pages/index/index.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAKA;AAAA;AACA;AAAA;AAIA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAEA;AAGA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAEA;AAAA;AAEA;AAAA;AAIA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAGA;AAAA;AAEA;AACA;AAEA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AAAA;AAGA;AAAA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAGA;AAAA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAEA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAEA;AAGA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAGA;AACA;AAAA;AAGA;AACA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAGA;;;;;;;;;;;;AC57BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://image-processing-tool/._src_pages_index_index.tsx","webpack://image-processing-tool/./src/pages/index/index.tsx?743a"],"sourcesContent":["import { useState, useRef, useEffect } from 'react'\nimport { View, Text, Canvas, Image, Button, Slider, Input, Checkbox } from '@tarojs/components'\nimport Taro, { useShareAppMessage } from '@tarojs/taro'\nimport './index.css'\n\nconst createImageProcessor = (canvasId) => {\n  let canvas = null\n  let ctx = null\n\n  const init = () => {\n    const query = Taro.createSelectorQuery()\n    query.select(`#${canvasId}`)\n      .fields({ node: true, size: true })\n      .exec((res) => {\n        if (res[0]) {\n          canvas = res[0].node\n          ctx = canvas.getContext('2d')\n        }\n      })\n  }\n\n  const loadImage = (src) => {\n    return new Promise((resolve, reject) => {\n      const img = canvas.createImage()\n      img.onload = () => resolve(img)\n      img.onerror = reject\n      img.src = src\n    })\n  }\n\n  const compress = (\n    img,\n    quality,\n    maxWidth,\n    maxHeight\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    let width = img.width\n    let height = img.height\n\n    if (maxWidth && width > maxWidth) {\n      height = (maxWidth / width) * height\n      width = maxWidth\n    }\n    if (maxHeight && height > maxHeight) {\n      width = (maxHeight / height) * width\n      height = maxHeight\n    }\n\n    canvas.width = width\n    canvas.height = height\n    ctx.drawImage(img, 0, 0, width, height)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        fileType: 'jpg',\n        quality: quality,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const resize = (\n    img,\n    width,\n    height,\n    maintainAspectRatio\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    let finalWidth = width\n    let finalHeight = height\n\n    if (maintainAspectRatio) {\n      const aspectRatio = img.width / img.height\n      if (width / height > aspectRatio) {\n        finalWidth = height * aspectRatio\n      } else {\n        finalHeight = width / aspectRatio\n      }\n    }\n\n    canvas.width = finalWidth\n    canvas.height = finalHeight\n    ctx.drawImage(img, 0, 0, finalWidth, finalHeight)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const convert = (img, format) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        fileType: format,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const rotate = (img, degrees) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    const radians = (degrees * Math.PI) / 180\n    const sin = Math.abs(Math.sin(radians))\n    const cos = Math.abs(Math.cos(radians))\n\n    const newWidth = img.width * cos + img.height * sin\n    const newHeight = img.width * sin + img.height * cos\n\n    canvas.width = newWidth\n    canvas.height = newHeight\n\n    ctx.translate(newWidth / 2, newHeight / 2)\n    ctx.rotate(radians)\n    ctx.drawImage(img, -img.width / 2, -img.height / 2)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const flip = (img, direction) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n\n    if (direction === 'horizontal') {\n      ctx.translate(img.width, 0)\n      ctx.scale(-1, 1)\n    } else {\n      ctx.translate(0, img.height)\n      ctx.scale(1, -1)\n    }\n\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const applyFilter = (\n    img,\n    filterType,\n    value\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n\n    let filter = ''\n    switch (filterType) {\n      case 'grayscale':\n        filter = `grayscale(${value}%)`\n        break\n      case 'sepia':\n        filter = `sepia(${value}%)`\n        break\n      case 'brightness':\n        filter = `brightness(${value}%)`\n        break\n      case 'contrast':\n        filter = `contrast(${value}%)`\n        break\n      case 'blur':\n        filter = `blur(${value}px)`\n        break\n    }\n\n    ctx.filter = filter\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  return {\n    init,\n    loadImage,\n    compress,\n    resize,\n    convert,\n    rotate,\n    flip,\n    applyFilter\n  }\n}\n\nexport default function Index() {\n  const [image, setImage] = useState(null)\n  const [processedImage, setProcessedImage] = useState('')\n  const [processedImageInfo, setProcessedImageInfo] = useState(null)\n  const [processedImageSize, setProcessedImageSize] = useState(null)\n  const [activeTab, setActiveTab] = useState('compress')\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [customQuality, setCustomQuality] = useState('80')\n  const [customWidth, setCustomWidth] = useState('800')\n  const [customHeight, setCustomHeight] = useState('600')\n  const [maintainAspectRatio, setMaintainAspectRatio] = useState(true)\n  const processorRef = useRef(null)\n\n  const sizeOptions = [\n    { name: '一寸', width: 295, height: 413 },\n    { name: '小二寸', width: 413, height: 531 },\n    { name: '二寸', width: 413, height: 626 },\n    { name: '社保/身份证', width: 358, height: 441 },\n    { name: '四六级/计算机', width: 144, height: 192 },\n    { name: '卫生机构', width: 160, height: 210 },\n    { name: '毕业证', width: 480, height: 640 }\n  ]\n\n  const formatOptions = [\n    { name: 'PNG', value: 'png' },\n    { name: 'JPEG', value: 'jpg' },\n    { name: 'JPG', value: 'jpg' },\n    { name: 'WebP', value: 'webp' },\n    { name: 'TIFF', value: 'tiff' },\n    { name: 'AVIF', value: 'avif' },\n    { name: 'BMP', value: 'bmp' },\n    { name: 'GIF', value: 'gif' },\n    { name: 'ICO', value: 'ico' }\n  ]\n\n  useEffect(() => {\n    console.log('Page loaded.')\n    processorRef.current = createImageProcessor('imageCanvas')\n    processorRef.current.init()\n  }, [])\n\n  useShareAppMessage((res) => {\n    return {\n      title: '图片处理工具',\n      path: '/pages/index/index'\n    }\n  })\n\n  const tabs = [\n    { id: 'compress', label: '压缩' },\n    { id: 'resize', label: '尺寸' },\n    { id: 'convert', label: '格式' },\n    { id: 'edit', label: '编辑' },\n    { id: 'filter', label: '滤镜' }\n  ]\n\n  const handleImageSelect = async (tempFilePath) => {\n    try {\n      if (!processorRef.current) {\n        processorRef.current = createImageProcessor('imageCanvas')\n        processorRef.current.init()\n      }\n\n      const img = await processorRef.current.loadImage(tempFilePath)\n      \n      Taro.getFileInfo({\n        filePath: tempFilePath,\n        success: (fileInfo) => {\n          setImage({\n            src: tempFilePath,\n            file: { size: fileInfo.size },\n            img\n          })\n          setProcessedImage(null)\n        }\n      })\n    } catch (error) {\n      console.error('Failed to load image:', error)\n      Taro.showToast({\n        title: '图片加载失败',\n        icon: 'none'\n      })\n    }\n  }\n\n  const handleCompress = async (quality, maxWidth, maxHeight) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.compress(image.img, quality, maxWidth, maxHeight)\n      setProcessedImage(url)\n      \n      // 获取处理后图片的文件信息\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: '压缩完成',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Compression failed:', error)\n      Taro.showToast({\n        title: '压缩失败',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleResize = async (width, height, maintainAspectRatio) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.resize(image.img, width, height, maintainAspectRatio)\n      setProcessedImage(url)\n      setProcessedImageSize({ width, height })\n      \n      // 获取处理后图片的文件信息\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: '调整尺寸完成',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Resize failed:', error)\n      Taro.showToast({\n        title: '调整尺寸失败',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleConvert = async (format) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.convert(image.img, format)\n      setProcessedImage(url)\n      \n      // 获取处理后图片的文件信息\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: '格式转换完成',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Conversion failed:', error)\n      Taro.showToast({\n        title: '格式转换失败',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleRotate = async (degrees) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.rotate(image.img, degrees)\n      setProcessedImage(url)\n      \n      // 获取处理后图片的文件信息\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: '旋转完成',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Rotation failed:', error)\n      Taro.showToast({\n        title: '旋转失败',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleFlip = async (direction) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.flip(image.img, direction)\n      setProcessedImage(url)\n      \n      // 获取处理后图片的文件信息\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: '翻转完成',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Flip failed:', error)\n      Taro.showToast({\n        title: '翻转失败',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleFilter = async (filterType, value) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.applyFilter(image.img, filterType, value)\n      setProcessedImage(url)\n      \n      // 获取处理后图片的文件信息\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: '滤镜应用完成',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Filter failed:', error)\n      Taro.showToast({\n        title: '滤镜应用失败',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleCustomCompress = async () => {\n    if (!image || !processorRef.current) return\n\n    let quality = parseInt(customQuality)\n    \n    // 限制输入范围\n    if (isNaN(quality)) {\n      Taro.showToast({\n        title: '请输入有效数字',\n        icon: 'none'\n      })\n      return\n    }\n    \n    // 限制在10-100之间\n    quality = Math.max(10, Math.min(100, quality))\n    setCustomQuality(quality.toString())\n    \n    // 转换为0-1之间的值\n    const qualityValue = quality / 100\n    \n    await handleCompress(qualityValue)\n  }\n\n  const handleCustomResize = async () => {\n    if (!image || !processorRef.current) return\n\n    let width = parseInt(customWidth)\n    let height = parseInt(customHeight)\n    \n    // 限制输入范围\n    if (isNaN(width) || isNaN(height)) {\n      Taro.showToast({\n        title: '请输入有效数字',\n        icon: 'none'\n      })\n      return\n    }\n    \n    // 限制最小值\n    width = Math.max(1, width)\n    height = Math.max(1, height)\n    setCustomWidth(width.toString())\n    setCustomHeight(height.toString())\n    \n    await handleResize(width, height, maintainAspectRatio)\n  }\n\n  const handleDownload = async () => {\n    if (!processedImage) return\n\n    try {\n      await Taro.saveImageToPhotosAlbum({\n        filePath: processedImage\n      })\n      Taro.showToast({\n        title: '已保存到相册',\n        icon: 'success'\n      })\n    } catch (err) {\n      // 忽略用户取消保存的错误\n      if (err.errMsg !== 'saveImageToPhotosAlbum:fail cancel') {\n        console.error('Save failed:', err)\n        Taro.showToast({\n          title: '保存失败',\n          icon: 'none'\n        })\n      }\n    }\n  }\n\n\n\n  return (\n    <View className=\"index\">\n      <Canvas\n        id=\"imageCanvas\"\n        canvasId=\"imageCanvas\"\n        type=\"2d\"\n        style={{ width: '0px', height: '0px', position: 'fixed', left: '-9999px' }}\n      />\n\n      <View className=\"header\">\n        <Text className=\"title\">图片处理工具</Text>\n      </View>\n\n      <View className=\"content\">\n        {!image && (\n          <View className=\"upload-section\">\n            <View className=\"upload-card\">\n              <Text className=\"upload-title\">选择图片</Text>\n              <View className=\"upload-buttons\">\n                  <Button\n                    className=\"upload-btn\"\n                    onClick={() => {\n                      Taro.chooseImage({\n                        count: 1,\n                        sizeType: ['original', 'compressed'],\n                        sourceType: ['album', 'camera'],\n                        success: (res) => {\n                          handleImageSelect(res.tempFilePaths[0])\n                        },\n                        fail: (err) => {\n                          // 忽略用户取消选择的错误\n                          if (err.errMsg !== 'chooseImage:fail cancel') {\n                            console.error('选择图片失败:', err)\n                          }\n                        }\n                      })\n                    }}\n                  >\n                    选择图片\n                  </Button>\n                </View>\n            </View>\n          </View>\n        )}\n\n        {image && (\n          <View className=\"editor-section\">\n            <View className=\"tabs\">\n              {tabs.map(tab => (\n                <View\n                  key={tab.id}\n                  className={`tab ${activeTab === tab.id ? 'active' : ''}`}\n                  onClick={() => setActiveTab(tab.id)}\n                >\n                  <Text className=\"tab-text\">{tab.label}</Text>\n                </View>\n              ))}\n            </View>\n\n            <View className=\"preview-section\">\n              <View className=\"preview-card\">\n                <Text className=\"preview-title\">原始图片</Text>\n                <Image\n                  src={image.src}\n                  className=\"preview-image\"\n                  mode=\"aspectFit\"\n                />\n                <Text className=\"image-info\">\n                  ({(image.file.size / 1024).toFixed(2)} KB)\n                </Text>\n              </View>\n\n              {processedImage && (\n                <View className=\"preview-card\">\n                  <Text className=\"preview-title\">处理后图片</Text>\n                  <Image\n                    src={processedImage}\n                    className=\"preview-image\"\n                    mode=\"aspectFit\"\n                  />\n                  {processedImageInfo && (\n                    <Text className=\"image-info\">\n                      {processedImageSize ? `${processedImageSize.width}x${processedImageSize.height} ` : ''}({(processedImageInfo.size / 1024).toFixed(2)} KB)\n                    </Text>\n                  )}\n                </View>\n              )}\n            </View>\n\n            <View className=\"options-section\">\n              {activeTab === 'compress' && (\n                <View className=\"options-card\">\n                  <Text className=\"options-title\">压缩选项</Text>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">质量: 0.8</Text>\n                    <Button\n                      className=\"action-btn\"\n                      onClick={() => {\n                        setCustomQuality('80')\n                        handleCompress(0.8)\n                      }}\n                    >\n                      压缩 (80%)\n                    </Button>\n                  </View>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">质量: 0.6</Text>\n                    <Button\n                      className=\"action-btn\"\n                      onClick={() => {\n                        setCustomQuality('60')\n                        handleCompress(0.6)\n                      }}\n                    >\n                      压缩 (60%)\n                    </Button>\n                  </View>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">质量: 0.4</Text>\n                    <Button\n                      className=\"action-btn\"\n                      onClick={() => {\n                        setCustomQuality('40')\n                        handleCompress(0.4)\n                      }}\n                    >\n                      压缩 (40%)\n                    </Button>\n                  </View>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">自定义质量: {customQuality}%</Text>\n                    <View style={{ marginBottom: '20px' }}>\n                      <Slider\n                        value={parseInt(customQuality)}\n                        min=\"10\"\n                        max=\"100\"\n                        step=\"1\"\n                        onChanging={(e) => setCustomQuality(e.detail.value.toString())}\n                        style={{ width: '100%' }}\n                      />\n                    </View>\n                    <Button\n                      className=\"action-btn\"\n                      onClick={handleCustomCompress}\n                    >\n                      自定义压缩\n                    </Button>\n                  </View>\n                </View>\n              )}\n\n              {activeTab === 'resize' && (\n                <View className=\"options-card\">\n                  <Text className=\"options-title\">尺寸选项</Text>\n                  {sizeOptions.map((option, index) => (\n                    <View key={index} className=\"option-group\">\n                      <Text className=\"option-label\">{option.name} ({option.width}x{option.height})</Text>\n                      <Button\n                        className=\"action-btn\"\n                        onClick={() => {\n                          setCustomWidth(option.width.toString())\n                          setCustomHeight(option.height.toString())\n                          handleResize(option.width, option.height, true)\n                        }}\n                      >\n                        调整尺寸\n                      </Button>\n                    </View>\n                  ))}\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">自定义尺寸</Text>\n                    <View style={{ marginBottom: '10px' }}>\n                      <View style={{ display: 'flex', gap: '10px', marginBottom: '10px' }}>\n                        <View style={{ flex: 1 }}>\n                          <Text className=\"option-label\">宽度</Text>\n                          <Input\n                            value={customWidth}\n                            onInput={(e) => {\n                              console.log('Width input change:', e.detail.value)\n                              setCustomWidth(e.detail.value)\n                            }}\n                            placeholder=\"宽度\"\n                            style={{\n                              width: '100%',\n                              padding: '10px',\n                              border: '1px solid var(--border)',\n                              borderRadius: '8px',\n                              fontSize: '16px',\n                              backgroundColor: 'rgba(26, 26, 46, 0.8)',\n                              color: 'var(--text)'\n                            }}\n                          />\n                        </View>\n                        <View style={{ flex: 1 }}>\n                          <Text className=\"option-label\">高度</Text>\n                          <Input\n                            value={customHeight}\n                            onInput={(e) => {\n                              console.log('Height input change:', e.detail.value)\n                              setCustomHeight(e.detail.value)\n                            }}\n                            placeholder=\"高度\"\n                            style={{\n                              width: '100%',\n                              padding: '10px',\n                              border: '1px solid var(--border)',\n                              borderRadius: '8px',\n                              fontSize: '16px',\n                              backgroundColor: 'rgba(26, 26, 46, 0.8)',\n                              color: 'var(--text)'\n                            }}\n                          />\n                        </View>\n                      </View>\n                      <View style={{ marginBottom: '10px' }}>\n                        <View style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                          <Text className=\"option-label\">保持比例</Text>\n                          <Checkbox\n                            checked={maintainAspectRatio}\n                            onChange={(e) => setMaintainAspectRatio(e.detail.value)}\n                          />\n                        </View>\n                      </View>\n                    </View>\n                    <Button\n                      className=\"action-btn\"\n                      onClick={handleCustomResize}\n                    >\n                      自定义调整\n                    </Button>\n                  </View>\n                </View>\n              )}\n\n              {activeTab === 'convert' && (\n                <View className=\"options-card\">\n                  <Text className=\"options-title\">格式转换</Text>\n                  <View className=\"format-grid\">\n                    {formatOptions.map((format, index) => (\n                      <View key={index} className=\"format-item\">\n                        <Button\n                          className=\"format-btn\"\n                          onClick={() => handleConvert(format.value)}\n                        >\n                          {format.name}\n                        </Button>\n                      </View>\n                    ))}\n                  </View>\n                </View>\n              )}\n\n              {activeTab === 'edit' && (\n                <View className=\"options-card\">\n                  <Text className=\"options-title\">编辑选项</Text>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">旋转</Text>\n                    <View className=\"edit-buttons\">\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleRotate(-90)}\n                      >\n                        左转90°\n                      </Button>\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleRotate(90)}\n                      >\n                        右转90°\n                      </Button>\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleRotate(180)}\n                      >\n                        180°\n                      </Button>\n                    </View>\n                  </View>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">翻转</Text>\n                    <View className=\"edit-buttons\">\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFlip('horizontal')}\n                      >\n                        水平翻转\n                      </Button>\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFlip('vertical')}\n                      >\n                        垂直翻转\n                      </Button>\n                    </View>\n                  </View>\n                </View>\n              )}\n\n              {activeTab === 'filter' && (\n                <View className=\"options-card\">\n                  <Text className=\"options-title\">滤镜效果</Text>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">黑白</Text>\n                    <View className=\"filter-buttons\">\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFilter('grayscale', 50)}\n                      >\n                        50%\n                      </Button>\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFilter('grayscale', 100)}\n                      >\n                        100%\n                      </Button>\n                    </View>\n                  </View>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">复古</Text>\n                    <View className=\"filter-buttons\">\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFilter('sepia', 50)}\n                      >\n                        50%\n                      </Button>\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFilter('sepia', 100)}\n                      >\n                        100%\n                      </Button>\n                    </View>\n                  </View>\n                  <View className=\"option-group\">\n                    <Text className=\"option-label\">亮度</Text>\n                    <View className=\"filter-buttons\">\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFilter('brightness', 120)}\n                      >\n                        增亮\n                      </Button>\n                      <Button\n                        className=\"action-btn small\"\n                        onClick={() => handleFilter('brightness', 80)}\n                      >\n                        变暗\n                      </Button>\n                    </View>\n                  </View>\n                </View>\n              )}\n            </View>\n\n            <View className=\"actions-section\">\n              <Button\n                className=\"action-btn secondary\"\n                onClick={() => {\n                  setImage(null)\n                  setProcessedImage(null)\n                }}\n              >\n                重新选择\n              </Button>\n              {processedImage && (\n                <Button\n                  className=\"action-btn primary\"\n                  onClick={handleDownload}\n                >\n                  保存到相册\n                </Button>\n              )}\n            </View>\n          </View>\n        )}\n\n        {isProcessing && (\n          <View className=\"loading-overlay\">\n            <Text className=\"loading-text\">处理中...</Text>\n          </View>\n        )}\n      </View>\n    </View>\n  )\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/index/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"图片处理工具\"};\n\ncomponent.enableShareAppMessage = true\n\nvar taroOption = createPageConfig(component, 'pages/index/index', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}