"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[421],{7265:function(e,s,a){var i=a(8870),t=a(6540),n=a(118),l=a(758),c=a.n(l),o=a(4848);const r=e=>{let s=null,a=null;const i=()=>{const i=c().createSelectorQuery();i.select(`#${e}`).fields({node:!0,size:!0}).exec(e=>{e[0]&&(s=e[0].node,a=s.getContext("2d"))})},t=e=>new Promise((a,i)=>{const t=s.createImage();t.onload=()=>a(t),t.onerror=i,t.src=e}),n=(e,i,t,n)=>{if(!s||!a)throw new Error("Canvas not initialized");let l=e.width,o=e.height;return t&&l>t&&(o*=t/l,l=t),n&&o>n&&(l*=n/o,o=n),s.width=l,s.height=o,a.drawImage(e,0,0,l,o),new Promise(e=>{c().canvasToTempFilePath({canvas:s,fileType:"jpg",quality:i,success:s=>{e(s.tempFilePath)}})})},l=(e,i,t,n)=>{if(!s||!a)throw new Error("Canvas not initialized");let l=i,o=t;if(n){const s=e.width/e.height;i/t>s?l=t*s:o=i/s}return s.width=l,s.height=o,a.drawImage(e,0,0,l,o),new Promise(e=>{c().canvasToTempFilePath({canvas:s,success:s=>{e(s.tempFilePath)}})})},o=(e,i)=>{if(!s||!a)throw new Error("Canvas not initialized");return s.width=e.width,s.height=e.height,a.drawImage(e,0,0),new Promise(e=>{c().canvasToTempFilePath({canvas:s,fileType:i,success:s=>{e(s.tempFilePath)}})})},r=(e,i)=>{if(!s||!a)throw new Error("Canvas not initialized");const t=i*Math.PI/180,n=Math.abs(Math.sin(t)),l=Math.abs(Math.cos(t)),o=e.width*l+e.height*n,r=e.width*n+e.height*l;return s.width=o,s.height=r,a.translate(o/2,r/2),a.rotate(t),a.drawImage(e,-e.width/2,-e.height/2),new Promise(e=>{c().canvasToTempFilePath({canvas:s,success:s=>{e(s.tempFilePath)}})})},h=(e,i)=>{if(!s||!a)throw new Error("Canvas not initialized");return s.width=e.width,s.height=e.height,"horizontal"===i?(a.translate(e.width,0),a.scale(-1,1)):(a.translate(0,e.height),a.scale(1,-1)),a.drawImage(e,0,0),new Promise(e=>{c().canvasToTempFilePath({canvas:s,success:s=>{e(s.tempFilePath)}})})},d=(e,i,t)=>{if(!s||!a)throw new Error("Canvas not initialized");s.width=e.width,s.height=e.height;let n="";switch(i){case"grayscale":n=`grayscale(${t}%)`;break;case"sepia":n=`sepia(${t}%)`;break;case"brightness":n=`brightness(${t}%)`;break;case"contrast":n=`contrast(${t}%)`;break;case"blur":n=`blur(${t}px)`;break}return a.filter=n,a.drawImage(e,0,0),new Promise(e=>{c().canvasToTempFilePath({canvas:s,success:s=>{e(s.tempFilePath)}})})};return{init:i,loadImage:t,compress:n,resize:l,convert:o,rotate:r,flip:h,applyFilter:d}};function h(){const[e,s]=(0,t.useState)(null),[a,i]=(0,t.useState)(""),[h,d]=(0,t.useState)(null),[m,p]=(0,t.useState)(null),[x,u]=(0,t.useState)("compress"),[g,j]=(0,t.useState)(!1),[w,N]=(0,t.useState)("80"),[b,f]=(0,t.useState)("800"),[v,S]=(0,t.useState)("600"),[y,C]=(0,t.useState)(!0),P=(0,t.useRef)(null),T=[{name:"\u4e00\u5bf8",width:295,height:413},{name:"\u5c0f\u4e8c\u5bf8",width:413,height:531},{name:"\u4e8c\u5bf8",width:413,height:626},{name:"\u793e\u4fdd/\u8eab\u4efd\u8bc1",width:358,height:441},{name:"\u56db\u516d\u7ea7/\u8ba1\u7b97\u673a",width:144,height:192},{name:"\u536b\u751f\u673a\u6784",width:160,height:210},{name:"\u6bd5\u4e1a\u8bc1",width:480,height:640}],E=[{name:"PNG",value:"png"},{name:"JPEG",value:"jpg"},{name:"JPG",value:"jpg"},{name:"WebP",value:"webp"},{name:"TIFF",value:"tiff"},{name:"AVIF",value:"avif"},{name:"BMP",value:"bmp"},{name:"GIF",value:"gif"},{name:"ICO",value:"ico"}];(0,t.useEffect)(()=>{console.log("Page loaded."),P.current=r("imageCanvas"),P.current.init()},[]),(0,l.useShareAppMessage)(e=>({title:"\u56fe\u7247\u5904\u7406\u5de5\u5177",path:"/pages/index/index"}));const z=[{id:"compress",label:"\u538b\u7f29"},{id:"resize",label:"\u5c3a\u5bf8"},{id:"convert",label:"\u683c\u5f0f"},{id:"edit",label:"\u7f16\u8f91"},{id:"filter",label:"\u6ee4\u955c"}],F=async e=>{try{P.current||(P.current=r("imageCanvas"),P.current.init());const a=await P.current.loadImage(e);c().getFileInfo({filePath:e,success:t=>{s({src:e,file:{size:t.size},img:a}),i(null)}})}catch(e){console.error("Failed to load image:",e),c().showToast({title:"\u56fe\u7247\u52a0\u8f7d\u5931\u8d25",icon:"none"})}},I=async(s,a,t)=>{if(e&&P.current){j(!0);try{const n=await P.current.compress(e.img,s,a,t);i(n),c().getFileInfo({filePath:n,success:e=>{d({size:e.size})}}),c().showToast({title:"\u538b\u7f29\u5b8c\u6210",icon:"success"})}catch(e){console.error("Compression failed:",e),c().showToast({title:"\u538b\u7f29\u5931\u8d25",icon:"none"})}finally{j(!1)}}},k=async(s,a,t)=>{if(e&&P.current){j(!0);try{const n=await P.current.resize(e.img,s,a,t);i(n),p({width:s,height:a}),c().getFileInfo({filePath:n,success:e=>{d({size:e.size})}}),c().showToast({title:"\u8c03\u6574\u5c3a\u5bf8\u5b8c\u6210",icon:"success"})}catch(e){console.error("Resize failed:",e),c().showToast({title:"\u8c03\u6574\u5c3a\u5bf8\u5931\u8d25",icon:"none"})}finally{j(!1)}}},$=async s=>{if(e&&P.current){j(!0);try{const a=await P.current.convert(e.img,s);i(a),c().getFileInfo({filePath:a,success:e=>{d({size:e.size})}}),c().showToast({title:"\u683c\u5f0f\u8f6c\u6362\u5b8c\u6210",icon:"success"})}catch(e){console.error("Conversion failed:",e),c().showToast({title:"\u683c\u5f0f\u8f6c\u6362\u5931\u8d25",icon:"none"})}finally{j(!1)}}},Y=async s=>{if(e&&P.current){j(!0);try{const a=await P.current.rotate(e.img,s);i(a),c().getFileInfo({filePath:a,success:e=>{d({size:e.size})}}),c().showToast({title:"\u65cb\u8f6c\u5b8c\u6210",icon:"success"})}catch(e){console.error("Rotation failed:",e),c().showToast({title:"\u65cb\u8f6c\u5931\u8d25",icon:"none"})}finally{j(!1)}}},M=async s=>{if(e&&P.current){j(!0);try{const a=await P.current.flip(e.img,s);i(a),c().getFileInfo({filePath:a,success:e=>{d({size:e.size})}}),c().showToast({title:"\u7ffb\u8f6c\u5b8c\u6210",icon:"success"})}catch(e){console.error("Flip failed:",e),c().showToast({title:"\u7ffb\u8f6c\u5931\u8d25",icon:"none"})}finally{j(!1)}}},B=async(s,a)=>{if(e&&P.current){j(!0);try{const t=await P.current.applyFilter(e.img,s,a);i(t),c().getFileInfo({filePath:t,success:e=>{d({size:e.size})}}),c().showToast({title:"\u6ee4\u955c\u5e94\u7528\u5b8c\u6210",icon:"success"})}catch(e){console.error("Filter failed:",e),c().showToast({title:"\u6ee4\u955c\u5e94\u7528\u5931\u8d25",icon:"none"})}finally{j(!1)}}},A=async()=>{if(!e||!P.current)return;let s=parseInt(w);if(isNaN(s))return void c().showToast({title:"\u8bf7\u8f93\u5165\u6709\u6548\u6570\u5b57",icon:"none"});s=Math.max(10,Math.min(100,s)),N(s.toString());const a=s/100;await I(a)},R=async()=>{if(!e||!P.current)return;let s=parseInt(b),a=parseInt(v);isNaN(s)||isNaN(a)?c().showToast({title:"\u8bf7\u8f93\u5165\u6709\u6548\u6570\u5b57",icon:"none"}):(s=Math.max(1,s),a=Math.max(1,a),f(s.toString()),S(a.toString()),await k(s,a,y))},G=async()=>{if(a)try{await c().saveImageToPhotosAlbum({filePath:a}),c().showToast({title:"\u5df2\u4fdd\u5b58\u5230\u76f8\u518c",icon:"success"})}catch(e){"saveImageToPhotosAlbum:fail cancel"!==e.errMsg&&(console.error("Save failed:",e),c().showToast({title:"\u4fdd\u5b58\u5931\u8d25",icon:"none"}))}};return(0,o.jsxs)(n.Ss,{className:"index",children:[(0,o.jsx)(n.Hl,{id:"imageCanvas",canvasId:"imageCanvas",type:"2d",style:{width:"0px",height:"0px",position:"fixed",left:"-9999px"}}),(0,o.jsx)(n.Ss,{className:"header",children:(0,o.jsx)(n.EY,{className:"title",children:"\u56fe\u7247\u5904\u7406\u5de5\u5177"})}),(0,o.jsxs)(n.Ss,{className:"content",children:[!e&&(0,o.jsx)(n.Ss,{className:"upload-section",children:(0,o.jsxs)(n.Ss,{className:"upload-card",children:[(0,o.jsx)(n.EY,{className:"upload-title",children:"\u9009\u62e9\u56fe\u7247"}),(0,o.jsx)(n.Ss,{className:"upload-buttons",children:(0,o.jsx)(n.$n,{className:"upload-btn",onClick:()=>{c().chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{F(e.tempFilePaths[0])},fail:e=>{"chooseImage:fail cancel"!==e.errMsg&&console.error("\u9009\u62e9\u56fe\u7247\u5931\u8d25:",e)}})},children:"\u9009\u62e9\u56fe\u7247"})})]})}),e&&(0,o.jsxs)(n.Ss,{className:"editor-section",children:[(0,o.jsx)(n.Ss,{className:"tabs",children:z.map(e=>(0,o.jsx)(n.Ss,{className:"tab "+(x===e.id?"active":""),onClick:()=>u(e.id),children:(0,o.jsx)(n.EY,{className:"tab-text",children:e.label})},e.id))}),(0,o.jsxs)(n.Ss,{className:"preview-section",children:[(0,o.jsxs)(n.Ss,{className:"preview-card",children:[(0,o.jsx)(n.EY,{className:"preview-title",children:"\u539f\u59cb\u56fe\u7247"}),(0,o.jsx)(n._V,{src:e.src,className:"preview-image",mode:"aspectFit"}),(0,o.jsxs)(n.EY,{className:"image-info",children:["(",(e.file.size/1024).toFixed(2)," KB)"]})]}),a&&(0,o.jsxs)(n.Ss,{className:"preview-card",children:[(0,o.jsx)(n.EY,{className:"preview-title",children:"\u5904\u7406\u540e\u56fe\u7247"}),(0,o.jsx)(n._V,{src:a,className:"preview-image",mode:"aspectFit"}),h&&(0,o.jsxs)(n.EY,{className:"image-info",children:[m?`${m.width}x${m.height} `:"","(",(h.size/1024).toFixed(2)," KB)"]})]})]}),(0,o.jsxs)(n.Ss,{className:"options-section",children:["compress"===x&&(0,o.jsxs)(n.Ss,{className:"options-card",children:[(0,o.jsx)(n.EY,{className:"options-title",children:"\u538b\u7f29\u9009\u9879"}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u8d28\u91cf: 0.8"}),(0,o.jsx)(n.$n,{className:"action-btn",onClick:()=>{N("80"),I(.8)},children:"\u538b\u7f29 (80%)"})]}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u8d28\u91cf: 0.6"}),(0,o.jsx)(n.$n,{className:"action-btn",onClick:()=>{N("60"),I(.6)},children:"\u538b\u7f29 (60%)"})]}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u8d28\u91cf: 0.4"}),(0,o.jsx)(n.$n,{className:"action-btn",onClick:()=>{N("40"),I(.4)},children:"\u538b\u7f29 (40%)"})]}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsxs)(n.EY,{className:"option-label",children:["\u81ea\u5b9a\u4e49\u8d28\u91cf: ",w,"%"]}),(0,o.jsx)(n.Ss,{style:{marginBottom:"20px"},children:(0,o.jsx)(n.Ap,{value:parseInt(w),min:"10",max:"100",step:"1",onChanging:e=>N(e.detail.value.toString()),style:{width:"100%"}})}),(0,o.jsx)(n.$n,{className:"action-btn",onClick:A,children:"\u81ea\u5b9a\u4e49\u538b\u7f29"})]})]}),"resize"===x&&(0,o.jsxs)(n.Ss,{className:"options-card",children:[(0,o.jsx)(n.EY,{className:"options-title",children:"\u5c3a\u5bf8\u9009\u9879"}),T.map((e,s)=>(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsxs)(n.EY,{className:"option-label",children:[e.name," (",e.width,"x",e.height,")"]}),(0,o.jsx)(n.$n,{className:"action-btn",onClick:()=>{f(e.width.toString()),S(e.height.toString()),k(e.width,e.height,!0)},children:"\u8c03\u6574\u5c3a\u5bf8"})]},s)),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u81ea\u5b9a\u4e49\u5c3a\u5bf8"}),(0,o.jsxs)(n.Ss,{style:{marginBottom:"10px"},children:[(0,o.jsxs)(n.Ss,{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[(0,o.jsxs)(n.Ss,{style:{flex:1},children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u5bbd\u5ea6"}),(0,o.jsx)(n.pd,{value:b,onInput:e=>{console.log("Width input change:",e.detail.value),f(e.detail.value)},placeholder:"\u5bbd\u5ea6",style:{width:"100%",padding:"10px",border:"1px solid var(--border)",borderRadius:"8px",fontSize:"16px",backgroundColor:"rgba(26, 26, 46, 0.8)",color:"var(--text)"}})]}),(0,o.jsxs)(n.Ss,{style:{flex:1},children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u9ad8\u5ea6"}),(0,o.jsx)(n.pd,{value:v,onInput:e=>{console.log("Height input change:",e.detail.value),S(e.detail.value)},placeholder:"\u9ad8\u5ea6",style:{width:"100%",padding:"10px",border:"1px solid var(--border)",borderRadius:"8px",fontSize:"16px",backgroundColor:"rgba(26, 26, 46, 0.8)",color:"var(--text)"}})]})]}),(0,o.jsx)(n.Ss,{style:{marginBottom:"10px"},children:(0,o.jsxs)(n.Ss,{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u4fdd\u6301\u6bd4\u4f8b"}),(0,o.jsx)(n.Sc,{checked:y,onChange:e=>C(e.detail.value)})]})})]}),(0,o.jsx)(n.$n,{className:"action-btn",onClick:R,children:"\u81ea\u5b9a\u4e49\u8c03\u6574"})]})]}),"convert"===x&&(0,o.jsxs)(n.Ss,{className:"options-card",children:[(0,o.jsx)(n.EY,{className:"options-title",children:"\u683c\u5f0f\u8f6c\u6362"}),(0,o.jsx)(n.Ss,{className:"format-grid",children:E.map((e,s)=>(0,o.jsx)(n.Ss,{className:"format-item",children:(0,o.jsx)(n.$n,{className:"format-btn",onClick:()=>$(e.value),children:e.name})},s))})]}),"edit"===x&&(0,o.jsxs)(n.Ss,{className:"options-card",children:[(0,o.jsx)(n.EY,{className:"options-title",children:"\u7f16\u8f91\u9009\u9879"}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u65cb\u8f6c"}),(0,o.jsxs)(n.Ss,{className:"edit-buttons",children:[(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>Y(-90),children:"\u5de6\u8f6c90\xb0"}),(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>Y(90),children:"\u53f3\u8f6c90\xb0"}),(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>Y(180),children:"180\xb0"})]})]}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u7ffb\u8f6c"}),(0,o.jsxs)(n.Ss,{className:"edit-buttons",children:[(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>M("horizontal"),children:"\u6c34\u5e73\u7ffb\u8f6c"}),(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>M("vertical"),children:"\u5782\u76f4\u7ffb\u8f6c"})]})]})]}),"filter"===x&&(0,o.jsxs)(n.Ss,{className:"options-card",children:[(0,o.jsx)(n.EY,{className:"options-title",children:"\u6ee4\u955c\u6548\u679c"}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u9ed1\u767d"}),(0,o.jsxs)(n.Ss,{className:"filter-buttons",children:[(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>B("grayscale",50),children:"50%"}),(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>B("grayscale",100),children:"100%"})]})]}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u590d\u53e4"}),(0,o.jsxs)(n.Ss,{className:"filter-buttons",children:[(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>B("sepia",50),children:"50%"}),(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>B("sepia",100),children:"100%"})]})]}),(0,o.jsxs)(n.Ss,{className:"option-group",children:[(0,o.jsx)(n.EY,{className:"option-label",children:"\u4eae\u5ea6"}),(0,o.jsxs)(n.Ss,{className:"filter-buttons",children:[(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>B("brightness",120),children:"\u589e\u4eae"}),(0,o.jsx)(n.$n,{className:"action-btn small",onClick:()=>B("brightness",80),children:"\u53d8\u6697"})]})]})]})]}),(0,o.jsxs)(n.Ss,{className:"actions-section",children:[(0,o.jsx)(n.$n,{className:"action-btn secondary",onClick:()=>{s(null),i(null)},children:"\u91cd\u65b0\u9009\u62e9"}),a&&(0,o.jsx)(n.$n,{className:"action-btn primary",onClick:G,children:"\u4fdd\u5b58\u5230\u76f8\u518c"})]})]}),g&&(0,o.jsx)(n.Ss,{className:"loading-overlay",children:(0,o.jsx)(n.EY,{className:"loading-text",children:"\u5904\u7406\u4e2d..."})})]})]})}var d={navigationBarTitleText:"\u56fe\u7247\u5904\u7406\u5de5\u5177"};h.enableShareAppMessage=!0;var m=(0,i.eU)(h,"pages/index/index",{root:{cn:[]}},d||{});h&&h.behaviors&&(m.behaviors=(m.behaviors||[]).concat(h.behaviors));Page(m)}},function(e){var s=function(s){return e(e.s=s)};e.O(0,[907,96],function(){return s(7265)});e.O()}]);