{"version":3,"file":"pages/editor/index.js","mappings":";;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AAAA;AAGA;AAAA;AACA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AAAA;AAGA;AAAA;AACA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAIA;AACA;AAAA;AAEA;AAEA;AACA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAGA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAEA;AAEA;AAIA;AAAA;AAEA;AACA;AAAA;AAGA;AAGA;AACA;AAAA;AAGA;AACA;AAIA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAGA;AAEA;;;;;;;;;;;;ACz6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://image-processing-tool/._src_pages_editor_index.tsx","webpack://image-processing-tool/./src/pages/editor/index.tsx?d5b2"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react'\nimport { View, Text, Button, Image, Canvas, Slider } from '@tarojs/components'\nimport Taro, { useLoad } from '@tarojs/taro'\nimport './index.css'\n\nconst createImageProcessor = (canvasId) => {\n  let canvas = null\n  let ctx = null\n\n  const init = () => {\n    const query = Taro.createSelectorQuery()\n    query.select(`#${canvasId}`)\n      .fields({ node: true, size: true })\n      .exec((res) => {\n        if (res[0]) {\n          canvas = res[0].node\n          ctx = canvas.getContext('2d')\n        }\n      })\n  }\n\n  const loadImage = (src) => {\n    return new Promise((resolve, reject) => {\n      const img = canvas.createImage()\n      img.onload = () => resolve(img)\n      img.onerror = reject\n      img.src = src\n    })\n  }\n\n  const compress = (\n    img,\n    quality,\n    maxWidth,\n    maxHeight\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    let width = img.width\n    let height = img.height\n\n    if (maxWidth && width > maxWidth) {\n      height = (maxWidth / width) * height\n      width = maxWidth\n    }\n    if (maxHeight && height > maxHeight) {\n      width = (maxHeight / height) * width\n      height = maxHeight\n    }\n\n    canvas.width = width\n    canvas.height = height\n    ctx.drawImage(img, 0, 0, width, height)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        fileType: 'jpg',\n        quality: quality,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const resize = (\n    img,\n    width,\n    height,\n    maintainAspectRatio\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    let finalWidth = width\n    let finalHeight = height\n\n    if (maintainAspectRatio) {\n      const aspectRatio = img.width / img.height\n      if (width / height > aspectRatio) {\n        finalWidth = height * aspectRatio\n      } else {\n        finalHeight = width / aspectRatio\n      }\n    }\n\n    canvas.width = finalWidth\n    canvas.height = finalHeight\n    ctx.drawImage(img, 0, 0, finalWidth, finalHeight)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const convert = (img, format) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        fileType: format,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const rotate = (img, degrees) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    const radians = (degrees * Math.PI) / 180\n    const sin = Math.abs(Math.sin(radians))\n    const cos = Math.abs(Math.cos(radians))\n\n    const newWidth = img.width * cos + img.height * sin\n    const newHeight = img.width * sin + img.height * cos\n\n    canvas.width = newWidth\n    canvas.height = newHeight\n\n    ctx.translate(newWidth / 2, newHeight / 2)\n    ctx.rotate(radians)\n    ctx.drawImage(img, -img.width / 2, -img.height / 2)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const flip = (img, direction) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n\n    if (direction === 'horizontal') {\n      ctx.translate(img.width, 0)\n      ctx.scale(-1, 1)\n    } else {\n      ctx.translate(0, img.height)\n      ctx.scale(1, -1)\n    }\n\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const applyFilter = (\n    img,\n    filterType,\n    value\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n\n    let filter = ''\n    switch (filterType) {\n      case 'grayscale':\n        filter = `grayscale(${value}%)`\n        break\n      case 'sepia':\n        filter = `sepia(${value}%)`\n        break\n      case 'brightness':\n        filter = `brightness(${value}%)`\n        break\n      case 'contrast':\n        filter = `contrast(${value}%)`\n        break\n      case 'blur':\n        filter = `blur(${value}px)`\n        break\n    }\n\n    ctx.filter = filter\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  return {\n    init,\n    loadImage,\n    compress,\n    resize,\n    convert,\n    rotate,\n    flip,\n    applyFilter\n  }\n}\n\nconst sizeOptions = [\n  { name: 'ä¸€å¯¸', width: 295, height: 413 },\n  { name: 'å°äºŒå¯¸', width: 413, height: 531 },\n  { name: 'äºŒå¯¸', width: 413, height: 626 },\n  { name: 'ç¤¾ä¿/èº«ä»½è¯', width: 358, height: 441 },\n  { name: 'å››å…­çº§/è®¡ç®—æœº', width: 144, height: 192 },\n  { name: 'å«ç”Ÿæœºæ„', width: 160, height: 210 },\n  { name: 'æ¯•ä¸šè¯', width: 480, height: 640 }\n]\n\nconst formatOptions = [\n  { name: 'PNG', value: 'png' },\n  { name: 'JPEG', value: 'jpg' },\n  { name: 'JPG', value: 'jpg' },\n  { name: 'WebP', value: 'webp' },\n  { name: 'TIFF', value: 'tiff' },\n  { name: 'AVIF', value: 'avif' },\n  { name: 'BMP', value: 'bmp' },\n  { name: 'GIF', value: 'gif' },\n  { name: 'ICO', value: 'ico' }\n]\n\nconst Editor = () => {\n  const [image, setImage] = useState(null)\n  const [processedImage, setProcessedImage] = useState('')\n  const [processedImageInfo, setProcessedImageInfo] = useState(null)\n  const [processedImageSize, setProcessedImageSize] = useState(null)\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [customQuality, setCustomQuality] = useState('80')\n  const [customWidth, setCustomWidth] = useState('800')\n  const [customHeight, setCustomHeight] = useState('600')\n  const [maintainAspectRatio, setMaintainAspectRatio] = useState(true)\n  const [featureType, setFeatureType] = useState('compress')\n  const processorRef = useRef(null)\n\n  useEffect(() => {\n    console.log('Editor page loaded.')\n    processorRef.current = createImageProcessor('imageCanvas')\n    processorRef.current.init()\n\n    // è·å–ä¼ é€’çš„åŠŸèƒ½ç±»å‹å‚æ•°\n    const pages = Taro.getCurrentPages()\n    const currentPage = pages[pages.length - 1]\n    if (currentPage.options && currentPage.options.type) {\n      setFeatureType(currentPage.options.type)\n    }\n  }, [])\n\n  const handleImageSelect = async (tempFilePath) => {\n    try {\n      if (!processorRef.current) {\n        processorRef.current = createImageProcessor('imageCanvas')\n        processorRef.current.init()\n      }\n\n      const img = await processorRef.current.loadImage(tempFilePath)\n      \n      Taro.getFileInfo({\n        filePath: tempFilePath,\n        success: (fileInfo) => {\n          setImage({\n            src: tempFilePath,\n            file: { size: fileInfo.size },\n            img\n          })\n          setProcessedImage(null)\n          setProcessedImageInfo(null)\n          setProcessedImageSize(null)\n        }\n      })\n    } catch (error) {\n      console.error('Failed to load image:', error)\n      Taro.showToast({\n        title: 'å›¾ç‰‡åŠ è½½å¤±è´¥',\n        icon: 'none'\n      })\n    }\n  }\n\n  const handleReupload = () => {\n    selectImage()\n  }\n\n  const selectImage = () => {\n    Taro.chooseImage({\n      count: 1,\n      sizeType: ['original', 'compressed'],\n      sourceType: ['album', 'camera'],\n      success: (res) => {\n        handleImageSelect(res.tempFilePaths[0])\n      },\n      fail: (err) => {\n        // å¿½ç•¥ç”¨æˆ·å–æ¶ˆé€‰æ‹©çš„é”™è¯¯\n        if (err.errMsg !== 'chooseImage:fail cancel') {\n          console.error('é€‰æ‹©å›¾ç‰‡å¤±è´¥:', err)\n        }\n      }\n    })\n  }\n\n  const handleCompress = async (quality, maxWidth, maxHeight) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.compress(image.img, quality, maxWidth, maxHeight)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'å‹ç¼©å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Compression failed:', error)\n      Taro.showToast({\n        title: 'å‹ç¼©å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleResize = async (width, height, maintainAspectRatio) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.resize(image.img, width, height, maintainAspectRatio)\n      setProcessedImage(url)\n      setProcessedImageSize({ width, height })\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'è°ƒæ•´å°ºå¯¸å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Resize failed:', error)\n      Taro.showToast({\n        title: 'è°ƒæ•´å°ºå¯¸å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleConvert = async (format) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.convert(image.img, format)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'æ ¼å¼è½¬æ¢å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Conversion failed:', error)\n      Taro.showToast({\n        title: 'æ ¼å¼è½¬æ¢å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleRotate = async (degrees) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.rotate(image.img, degrees)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'æ—‹è½¬å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Rotation failed:', error)\n      Taro.showToast({\n        title: 'æ—‹è½¬å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleFlip = async (direction) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.flip(image.img, direction)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'ç¿»è½¬å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Flip failed:', error)\n      Taro.showToast({\n        title: 'ç¿»è½¬å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleFilter = async (filterType, value) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.applyFilter(image.img, filterType, value)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'æ»¤é•œåº”ç”¨å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Filter failed:', error)\n      Taro.showToast({\n        title: 'æ»¤é•œåº”ç”¨å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleCustomCompress = async () => {\n    if (!image || !processorRef.current) return\n\n    let quality = parseInt(customQuality)\n    \n    // é™åˆ¶è¾“å…¥èŒƒå›´\n    if (isNaN(quality)) {\n      Taro.showToast({\n        title: 'è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—',\n        icon: 'none'\n      })\n      return\n    }\n    \n    // é™åˆ¶åœ¨10-100ä¹‹é—´\n    quality = Math.max(10, Math.min(100, quality))\n    setCustomQuality(quality.toString())\n    \n    // è½¬æ¢ä¸º0-1ä¹‹é—´çš„å€¼\n    const qualityValue = quality / 100\n    \n    await handleCompress(qualityValue)\n  }\n\n  const handleCustomResize = async () => {\n    if (!image || !processorRef.current) return\n\n    let width = parseInt(customWidth)\n    let height = parseInt(customHeight)\n    \n    // é™åˆ¶è¾“å…¥èŒƒå›´\n    if (isNaN(width) || isNaN(height)) {\n      Taro.showToast({\n        title: 'è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—',\n        icon: 'none'\n      })\n      return\n    }\n    \n    // é™åˆ¶æœ€å°å€¼\n    width = Math.max(1, width)\n    height = Math.max(1, height)\n    setCustomWidth(width.toString())\n    setCustomHeight(height.toString())\n    \n    await handleResize(width, height, maintainAspectRatio)\n  }\n\n  const handleDownload = async () => {\n    if (!processedImage) return\n\n    try {\n      await Taro.saveImageToPhotosAlbum({\n        filePath: processedImage\n      })\n      Taro.showToast({\n        title: 'å·²ä¿å­˜åˆ°ç›¸å†Œ',\n        icon: 'success'\n      })\n    } catch (err) {\n      // å¿½ç•¥ç”¨æˆ·å–æ¶ˆä¿å­˜çš„é”™è¯¯\n      if (err.errMsg !== 'saveImageToPhotosAlbum:fail cancel') {\n        console.error('Save failed:', err)\n        Taro.showToast({\n          title: 'ä¿å­˜å¤±è´¥',\n          icon: 'none'\n        })\n      }\n    }\n  }\n\n  const renderFeatureOptions = () => {\n    switch (featureType) {\n      case 'compress':\n        return (\n          <View className=\"options-section\">\n            <Text className=\"options-title\">å‹ç¼©é€‰é¡¹</Text>\n            <View style={{ marginBottom: '20px' }}>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>è´¨é‡: 0.8</Text>\n              <Button\n                className=\"action-btn\"\n                onClick={() => {\n                  setCustomQuality('80')\n                  handleCompress(0.8)\n                }}\n                style={{ marginBottom: '10px' }}\n              >\n                å‹ç¼© (80%)\n              </Button>\n            </View>\n            <View style={{ marginBottom: '20px' }}>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>è´¨é‡: 0.6</Text>\n              <Button\n                className=\"action-btn\"\n                onClick={() => {\n                  setCustomQuality('60')\n                  handleCompress(0.6)\n                }}\n                style={{ marginBottom: '10px' }}\n              >\n                å‹ç¼© (60%)\n              </Button>\n            </View>\n            <View style={{ marginBottom: '20px' }}>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>è´¨é‡: 0.4</Text>\n              <Button\n                className=\"action-btn\"\n                onClick={() => {\n                  setCustomQuality('40')\n                  handleCompress(0.4)\n                }}\n                style={{ marginBottom: '10px' }}\n              >\n                å‹ç¼© (40%)\n              </Button>\n            </View>\n            <View>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>è‡ªå®šä¹‰è´¨é‡: {customQuality}%</Text>\n              <View style={{ marginBottom: '20px' }}>\n                <Slider\n                  value={parseInt(customQuality)}\n                  min={10}\n                  max={100}\n                  step={1}\n                  onChange={(e) => setCustomQuality(e.detail.value.toString())}\n                  style={{ width: '100%' }}\n                />\n              </View>\n              <Button\n                className=\"action-btn\"\n                onClick={handleCustomCompress}\n              >\n                è‡ªå®šä¹‰å‹ç¼©\n              </Button>\n            </View>\n          </View>\n        )\n      \n      case 'resize':\n        return (\n          <View className=\"options-section\">\n            <Text className=\"options-title\">å°ºå¯¸é€‰é¡¹</Text>\n            {sizeOptions.map((option, index) => (\n              <View key={index} className=\"size-option\">\n                <Text className=\"size-option-label\">{option.name} ({option.width}x{option.height})</Text>\n                <Button\n                  className=\"size-option-btn\"\n                  onClick={() => {\n                    setCustomWidth(option.width.toString())\n                    setCustomHeight(option.height.toString())\n                    handleResize(option.width, option.height, true)\n                  }}\n                >\n                  è°ƒæ•´å°ºå¯¸\n                </Button>\n              </View>\n            ))}\n            <View>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>è‡ªå®šä¹‰å°ºå¯¸</Text>\n              <View style={{ marginBottom: '15px' }}>\n                <View style={{ display: 'flex', gap: '10px', marginBottom: '10px' }}>\n                  <View style={{ flex: 1 }}>\n                    <Text style={{ fontSize: '14px', color: '#666', marginBottom: '5px', display: 'block' }}>å®½åº¦</Text>\n                    <input\n                      type=\"number\"\n                      value={customWidth}\n                      onChange={(e) => setCustomWidth(e.target.value)}\n                      style={{\n                        width: '100%',\n                        padding: '10px',\n                        border: '1px solid #ddd',\n                        borderRadius: '8px',\n                        fontSize: '16px'\n                      }}\n                    />\n                  </View>\n                  <View style={{ flex: 1 }}>\n                    <Text style={{ fontSize: '14px', color: '#666', marginBottom: '5px', display: 'block' }}>é«˜åº¦</Text>\n                    <input\n                      type=\"number\"\n                      value={customHeight}\n                      onChange={(e) => setCustomHeight(e.target.value)}\n                      style={{\n                        width: '100%',\n                        padding: '10px',\n                        border: '1px solid #ddd',\n                        borderRadius: '8px',\n                        fontSize: '16px'\n                      }}\n                    />\n                  </View>\n                </View>\n                <View style={{ marginBottom: '10px' }}>\n                  <label style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n                    <input\n                      type=\"checkbox\"\n                      checked={maintainAspectRatio}\n                      onChange={(e) => setMaintainAspectRatio(e.target.checked)}\n                    />\n                    <Text style={{ fontSize: '14px', color: '#666' }}>ä¿æŒæ¯”ä¾‹</Text>\n                  </label>\n                </View>\n              </View>\n              <Button\n                className=\"action-btn\"\n                onClick={handleCustomResize}\n              >\n                è‡ªå®šä¹‰è°ƒæ•´\n              </Button>\n            </View>\n          </View>\n        )\n      \n      case 'convert':\n        return (\n          <View className=\"options-section\">\n            <Text className=\"options-title\">æ ¼å¼è½¬æ¢</Text>\n            <View className=\"format-grid\">\n              {formatOptions.map((format, index) => (\n                <Button\n                  key={index}\n                  className=\"format-btn\"\n                  onClick={() => handleConvert(format.value)}\n                >\n                  {format.name}\n                </Button>\n              ))}\n            </View>\n          </View>\n        )\n      \n      case 'edit':\n        return (\n          <View className=\"options-section\">\n            <Text className=\"options-title\">ç¼–è¾‘é€‰é¡¹</Text>\n            <View style={{ marginBottom: '20px' }}>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>æ—‹è½¬</Text>\n              <View className=\"edit-buttons\">\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleRotate(-90)}\n                >\n                  å·¦è½¬90Â°\n                </Button>\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleRotate(90)}\n                >\n                  å³è½¬90Â°\n                </Button>\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleRotate(180)}\n                >\n                  180Â°\n                </Button>\n              </View>\n            </View>\n            <View>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>ç¿»è½¬</Text>\n              <View className=\"edit-buttons\">\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFlip('horizontal')}\n                >\n                  æ°´å¹³ç¿»è½¬\n                </Button>\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFlip('vertical')}\n                >\n                  å‚ç›´ç¿»è½¬\n                </Button>\n              </View>\n            </View>\n          </View>\n        )\n      \n      case 'filter':\n        return (\n          <View className=\"options-section\">\n            <Text className=\"options-title\">æ»¤é•œæ•ˆæœ</Text>\n            <View style={{ marginBottom: '20px' }}>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>é»‘ç™½</Text>\n              <View className=\"filter-buttons\">\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFilter('grayscale', 50)}\n                >\n                  50%\n                </Button>\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFilter('grayscale', 100)}\n                >\n                  100%\n                </Button>\n              </View>\n            </View>\n            <View style={{ marginBottom: '20px' }}>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>å¤å¤</Text>\n              <View className=\"filter-buttons\">\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFilter('sepia', 50)}\n                >\n                  50%\n                </Button>\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFilter('sepia', 100)}\n                >\n                  100%\n                </Button>\n              </View>\n            </View>\n            <View>\n              <Text style={{ fontSize: '16px', color: '#666', marginBottom: '10px', display: 'block' }}>äº®åº¦</Text>\n              <View className=\"filter-buttons\">\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFilter('brightness', 120)}\n                >\n                  å¢äº®\n                </Button>\n                <Button\n                  className=\"action-btn\"\n                  onClick={() => handleFilter('brightness', 80)}\n                >\n                  å˜æš—\n                </Button>\n              </View>\n            </View>\n          </View>\n        )\n      \n      default:\n        return null\n    }\n  }\n\n  return (\n    <View className=\"editor\">\n      <Canvas\n        id=\"imageCanvas\"\n        canvasId=\"imageCanvas\"\n        type=\"2d\"\n        style={{ width: '0px', height: '0px', position: 'fixed', left: '-9999px' }}\n      />\n\n      {/* å®¢æœæŒ‰é’® */}\n      <View className=\"customer-service-btn\">\n        <Text className=\"service-icon\">ğŸ’¬</Text>\n        <Text className=\"service-text\">å®¢æœ</Text>\n      </View>\n\n      <View className=\"editor-content\">\n        {/* åˆå¹¶çš„å›¾ç‰‡æ˜¾ç¤ºå’Œæ“ä½œåŒºåŸŸ */}\n        <View className=\"scrollable-content\">\n          {!image ? (\n            <View className=\"upload-placeholder\" onClick={selectImage}>\n              <Text className=\"upload-icon\">ğŸ–¼ï¸</Text>\n              <Text className=\"upload-text\">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡{featureType === 'compress' ? 'å‹ç¼©' : ''}</Text>\n              <Button\n                className=\"action-btn\"\n                onClick={(e) => {\n                  e.stopPropagation() // é˜»æ­¢äº‹ä»¶å†’æ³¡\n                  selectImage()\n                }}\n                style={{ marginTop: '20px', width: '80%' }}\n              >\n                é€‰æ‹©å›¾ç‰‡\n              </Button>\n            </View>\n          ) : (\n            <>\n              <View className=\"image-preview-section\">\n                <Image\n                  src={image.src}\n                  className=\"preview-image\"\n                  mode=\"aspectFit\"\n                />\n                <View className=\"image-info-bar\">\n                  <Text className=\"image-size-text\">\n                    å›¾ç‰‡{featureType === 'compress' ? 'å‹ç¼©' : ''}å‰: {(image.file.size / 1024).toFixed(2)} KB\n                  </Text>\n                  <Text className=\"info-separator\">|</Text>\n                  <Text className=\"image-size-text\">\n                    å›¾ç‰‡{featureType === 'compress' ? 'å‹ç¼©' : ''}å: {processedImageInfo ? (processedImageInfo.size / 1024).toFixed(2) : '0'} KB\n                  </Text>\n                </View>\n              </View>\n              {renderFeatureOptions()}\n            </>\n          )}\n        </View>\n\n        {/* åº•éƒ¨å›ºå®šæŒ‰é’®åŒºåŸŸ */}\n        <View className=\"bottom-buttons\">\n          <Button\n            className=\"bottom-btn select-btn\"\n            onClick={selectImage}\n          >\n            é€‰æ‹©å›¾ç‰‡\n          </Button>\n          {processedImage && (\n            <Button\n              className=\"bottom-btn save-btn\"\n              onClick={handleDownload}\n            >\n              ä¿å­˜å›¾ç‰‡\n            </Button>\n          )}\n        </View>\n\n        {isProcessing && (\n          <View className=\"loading-overlay\">\n            <Text className=\"loading-text\">å¤„ç†ä¸­...</Text>\n          </View>\n        )}\n      </View>\n    </View>\n  )\n}\n\nexport default Editor","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/editor/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"å›¾ç‰‡ç¼–è¾‘\",\"navigationBarBackgroundColor\":\"#fff\",\"navigationBarTextStyle\":\"black\"};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/editor/index', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}