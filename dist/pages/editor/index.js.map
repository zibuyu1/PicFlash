{"version":3,"file":"pages/editor/index.js","mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AAEA;AACA;AACA;AAAA;AAIA;AACA;AACA;AAAA;AAGA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AAAA;AACA;AAIA;AAAA;AAEA;AACA;AAAA;AAGA;AAGA;AACA;AAAA;AAGA;AACA;AAIA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAGA;AAEA;;;;;;;;;;;;;;;;;AC9xBA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAGA;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AAAA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AAGA;AAEA;;;;;;;;;;;;;;AC3BA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAOA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAIA;AACA;AAAA;AAEA;AAEA;AACA;AAGA;AAEA;;;;;;;;;;;;;;ACrCA;AACA;AAAA;AAOA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAGA;AAEA;;;;;;;;;;;;;;ACxDA;AACA;AAAA;AAMA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAGA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAGA;AAEA;;;;;;;;;;;;;;AClEA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAGA;AAEA;AACA;AACA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAIA;AACA;AAAA;AAEA;AAEA;AACA;AACA;AAGA;AAEA;;;;;;;;;;;;ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://image-processing-tool/._src_pages_editor_index.tsx","webpack://image-processing-tool/._src_components_CompressOptions.tsx","webpack://image-processing-tool/._src_features_CompressFeature_index.tsx","webpack://image-processing-tool/._src_features_ConvertFeature_index.tsx","webpack://image-processing-tool/._src_features_EditFeature_index.tsx","webpack://image-processing-tool/._src_features_FilterFeature_index.tsx","webpack://image-processing-tool/._src_features_ResizeFeature_index.tsx","webpack://image-processing-tool/./src/pages/editor/index.tsx?d5b2"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react'\nimport { View, Text, Button, Image, Canvas } from '@tarojs/components'\nimport Taro from '@tarojs/taro'\nimport './index.css'\n\nimport CompressFeature from '../../features/CompressFeature'\nimport ResizeFeature from '../../features/ResizeFeature'\nimport ConvertFeature from '../../features/ConvertFeature'\nimport EditFeature from '../../features/EditFeature'\nimport FilterFeature from '../../features/FilterFeature'\n\nconst createImageProcessor = (canvasId) => {\n  let canvas = null\n  let ctx = null\n\n  const init = () => {\n    const query = Taro.createSelectorQuery()\n    query.select(`#${canvasId}`)\n      .fields({ node: true, size: true })\n      .exec((res) => {\n        if (res[0]) {\n          canvas = res[0].node\n          ctx = canvas.getContext('2d')\n        }\n      })\n  }\n\n  const loadImage = (src) => {\n    return new Promise((resolve, reject) => {\n      const img = canvas.createImage()\n      img.onload = () => resolve(img)\n      img.onerror = reject\n      img.src = src\n    })\n  }\n\n  const compress = (\n    img,\n    quality,\n    maxWidth,\n    maxHeight\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    let width = img.width\n    let height = img.height\n\n    if (maxWidth && width > maxWidth) {\n      height = (maxWidth / width) * height\n      width = maxWidth\n    }\n    if (maxHeight && height > maxHeight) {\n      width = (maxHeight / height) * width\n      height = maxHeight\n    }\n\n    canvas.width = width\n    canvas.height = height\n    ctx.drawImage(img, 0, 0, width, height)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        fileType: 'jpg',\n        quality: quality,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const resize = (\n    img,\n    width,\n    height,\n    scaleMode = 'cover'\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    const imgAspectRatio = img.width / img.height\n    const targetAspectRatio = width / height\n\n    let finalWidth, finalHeight, offsetX, offsetY\n\n    switch (scaleMode) {\n      case 'cover':\n        // å¡«æ»¡ç”»é¢ï¼ˆè£è¾¹ï¼‰\n        if (imgAspectRatio > targetAspectRatio) {\n          finalHeight = height\n          finalWidth = height * imgAspectRatio\n          offsetX = (width - finalWidth) / 2\n          offsetY = 0\n        } else {\n          finalWidth = width\n          finalHeight = width / imgAspectRatio\n          offsetX = 0\n          offsetY = (height - finalHeight) / 2\n        }\n        break\n      case 'contain':\n        // å®Œæ•´æ˜¾ç¤ºï¼ˆç•™ç©ºç™½ï¼‰\n        if (imgAspectRatio > targetAspectRatio) {\n          finalWidth = width\n          finalHeight = width / imgAspectRatio\n          offsetX = 0\n          offsetY = (height - finalHeight) / 2\n        } else {\n          finalHeight = height\n          finalWidth = height * imgAspectRatio\n          offsetX = (width - finalWidth) / 2\n          offsetY = 0\n        }\n        break\n      case 'stretch':\n        // æ‹‰ä¼¸å¡«æ»¡ï¼ˆå˜å½¢ï¼‰\n        finalWidth = width\n        finalHeight = height\n        offsetX = 0\n        offsetY = 0\n        break\n      case 'keep':\n        // ä¿ç•™å®Œæ•´ï¼ˆå¯èƒ½å°ï¼‰\n        if (img.width <= width && img.height <= height) {\n          // å›¾ç‰‡å°ºå¯¸å°äºç›®æ ‡å°ºå¯¸ï¼Œä¿æŒåŸå›¾å¤§å°\n          finalWidth = img.width\n          finalHeight = img.height\n        } else if (imgAspectRatio > targetAspectRatio) {\n          finalWidth = width\n          finalHeight = width / imgAspectRatio\n        } else {\n          finalHeight = height\n          finalWidth = height * imgAspectRatio\n        }\n        offsetX = (width - finalWidth) / 2\n        offsetY = (height - finalHeight) / 2\n        break\n      case 'cover_min':\n        // è‡³å°‘è¦†ç›–ï¼ˆå¯èƒ½è¶…å‡ºï¼‰\n        if (imgAspectRatio > targetAspectRatio) {\n          finalWidth = width\n          finalHeight = width / imgAspectRatio\n          if (finalHeight < height) {\n            finalHeight = height\n            finalWidth = height * imgAspectRatio\n          }\n        } else {\n          finalHeight = height\n          finalWidth = height * imgAspectRatio\n          if (finalWidth < width) {\n            finalWidth = width\n            finalHeight = width / imgAspectRatio\n          }\n        }\n        offsetX = (width - finalWidth) / 2\n        offsetY = (height - finalHeight) / 2\n        break\n      default:\n        // é»˜è®¤ä½¿ç”¨coveræ¨¡å¼\n        if (imgAspectRatio > targetAspectRatio) {\n          finalHeight = height\n          finalWidth = height * imgAspectRatio\n          offsetX = (width - finalWidth) / 2\n          offsetY = 0\n        } else {\n          finalWidth = width\n          finalHeight = width / imgAspectRatio\n          offsetX = 0\n          offsetY = (height - finalHeight) / 2\n        }\n    }\n\n    canvas.width = width\n    canvas.height = height\n    ctx.drawImage(img, offsetX, offsetY, finalWidth, finalHeight)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const convert = (img, format) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        fileType: format,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const rotate = (img, degrees) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    const radians = (degrees * Math.PI) / 180\n    const sin = Math.abs(Math.sin(radians))\n    const cos = Math.abs(Math.cos(radians))\n\n    const newWidth = img.width * cos + img.height * sin\n    const newHeight = img.width * sin + img.height * cos\n\n    canvas.width = newWidth\n    canvas.height = newHeight\n\n    ctx.translate(newWidth / 2, newHeight / 2)\n    ctx.rotate(radians)\n    ctx.drawImage(img, -img.width / 2, -img.height / 2)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const flip = (img, direction) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n\n    if (direction === 'horizontal') {\n      ctx.translate(img.width, 0)\n      ctx.scale(-1, 1)\n    } else {\n      ctx.translate(0, img.height)\n      ctx.scale(1, -1)\n    }\n\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  const applyFilter = (\n    img,\n    filterType,\n    value\n  ) => {\n    if (!canvas || !ctx) throw new Error('Canvas not initialized')\n\n    canvas.width = img.width\n    canvas.height = img.height\n\n    let filter = ''\n    switch (filterType) {\n      case 'grayscale':\n        filter = `grayscale(${value}%)`\n        break\n      case 'sepia':\n        filter = `sepia(${value}%)`\n        break\n      case 'brightness':\n        filter = `brightness(${value}%)`\n        break\n      case 'contrast':\n        filter = `contrast(${value}%)`\n        break\n      case 'blur':\n        filter = `blur(${value}px)`\n        break\n    }\n\n    ctx.filter = filter\n    ctx.drawImage(img, 0, 0)\n\n    return new Promise((resolve) => {\n      Taro.canvasToTempFilePath({\n        canvas: canvas,\n        success: (res) => {\n          resolve(res.tempFilePath)\n        }\n      })\n    })\n  }\n\n  return {\n    init,\n    loadImage,\n    compress,\n    resize,\n    convert,\n    rotate,\n    flip,\n    applyFilter\n  }\n}\n\nconst Editor = () => {\n  const [image, setImage] = useState(null)\n  const [processedImage, setProcessedImage] = useState('')\n  const [processedImageInfo, setProcessedImageInfo] = useState(null)\n  const [processedImageSize, setProcessedImageSize] = useState(null)\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [quality, setQuality] = useState(0.8)\n  const [customQuality, setCustomQuality] = useState('80')\n  const [featureType, setFeatureType] = useState('compress')\n  const [scaleMode, setScaleMode] = useState('cover')\n  const [comparisonPosition, setComparisonPosition] = useState(50)\n  const [showOriginal, setShowOriginal] = useState(false)\n  const processorRef = useRef(null)\n\n  useEffect(() => {\n    console.log('Editor page loaded.')\n    processorRef.current = createImageProcessor('imageCanvas')\n    processorRef.current.init()\n\n    // è·å–ä¼ é€’çš„åŠŸèƒ½ç±»å‹å‚æ•°\n    try {\n      const pages = Taro.getCurrentPages()\n      const currentPage = pages[pages.length - 1]\n      if (currentPage && currentPage.options && currentPage.options.type) {\n        setFeatureType(currentPage.options.type)\n      }\n    } catch (error) {\n      console.error('Error getting feature type:', error)\n    }\n  }, [])\n\n  const handleImageSelect = async (tempFilePath) => {\n    try {\n      if (!processorRef.current) {\n        processorRef.current = createImageProcessor('imageCanvas')\n        processorRef.current.init()\n      }\n\n      const img = await processorRef.current.loadImage(tempFilePath)\n      \n      Taro.getFileInfo({\n        filePath: tempFilePath,\n        success: (fileInfo) => {\n          setImage({\n            src: tempFilePath,\n            file: { size: fileInfo.size },\n            img\n          })\n          setProcessedImage(null)\n          setProcessedImageInfo(null)\n          setProcessedImageSize(null)\n        }\n      })\n    } catch (error) {\n      console.error('Failed to load image:', error)\n      Taro.showToast({\n        title: 'å›¾ç‰‡åŠ è½½å¤±è´¥',\n        icon: 'none'\n      })\n    }\n  }\n\n  const selectImage = () => {\n    Taro.chooseImage({\n      count: 1,\n      sizeType: ['original', 'compressed'],\n      sourceType: ['album', 'camera'],\n      success: (res) => {\n        handleImageSelect(res.tempFilePaths[0])\n      },\n      fail: (err) => {\n        // å¿½ç•¥ç”¨æˆ·å–æ¶ˆé€‰æ‹©çš„é”™è¯¯\n        if (err.errMsg !== 'chooseImage:fail cancel') {\n          console.error('é€‰æ‹©å›¾ç‰‡å¤±è´¥:', err)\n        }\n      }\n    })\n  }\n\n  const handleCompress = async (quality, maxWidth, maxHeight) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.compress(image.img, quality, maxWidth, maxHeight)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'å‹ç¼©å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Compression failed:', error)\n      Taro.showToast({\n        title: 'å‹ç¼©å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleResize = async (width, height, scaleMode) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.resize(image.img, width, height, scaleMode)\n      setProcessedImage(url)\n      setProcessedImageSize({ width, height })\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'è°ƒæ•´å°ºå¯¸å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Resize failed:', error)\n      Taro.showToast({\n        title: 'è°ƒæ•´å°ºå¯¸å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleConvert = async (format) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.convert(image.img, format)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'æ ¼å¼è½¬æ¢å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Conversion failed:', error)\n      Taro.showToast({\n        title: 'æ ¼å¼è½¬æ¢å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleRotate = async (degrees) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.rotate(image.img, degrees)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'æ—‹è½¬å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Rotation failed:', error)\n      Taro.showToast({\n        title: 'æ—‹è½¬å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleFlip = async (direction) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.flip(image.img, direction)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'ç¿»è½¬å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Flip failed:', error)\n      Taro.showToast({\n        title: 'ç¿»è½¬å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleFilter = async (filterType, value) => {\n    if (!image || !processorRef.current) return\n\n    setIsProcessing(true)\n    try {\n      const url = await processorRef.current.applyFilter(image.img, filterType, value)\n      setProcessedImage(url)\n      \n      // è·å–å¤„ç†åå›¾ç‰‡çš„æ–‡ä»¶ä¿¡æ¯\n      Taro.getFileInfo({\n        filePath: url,\n        success: (fileInfo) => {\n          setProcessedImageInfo({ size: fileInfo.size })\n        }\n      })\n      \n      Taro.showToast({\n        title: 'æ»¤é•œåº”ç”¨å®Œæˆ',\n        icon: 'success'\n      })\n    } catch (error) {\n      console.error('Filter failed:', error)\n      Taro.showToast({\n        title: 'æ»¤é•œåº”ç”¨å¤±è´¥',\n        icon: 'none'\n      })\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  const handleComparisonStart = (e) => {\n    // å¼€å§‹æ‹–æ‹½ï¼Œä¸éœ€è¦ç‰¹æ®Šå¤„ç†\n  }\n\n  const handleComparisonMove = (e) => {\n    try {\n      // ç®€åŒ–å¤„ç†ï¼šç›´æ¥ä»äº‹ä»¶å¯¹è±¡ä¸­è·å–è§¦æ‘¸ç‚¹ä¿¡æ¯\n      // å°ç¨‹åºä¸­çš„è§¦æ‘¸äº‹ä»¶æ ¼å¼\n      const touches = e.touches || (e.detail && e.detail.touches)\n      if (!touches || touches.length === 0) return\n      \n      const touch = touches[0]\n      const pageX = touch.pageX\n      if (!pageX) return\n\n      // è·å–å±å¹•å®½åº¦\n      const screenWidth = Taro.getSystemInfoSync().windowWidth\n      if (!screenWidth) return\n\n      // è®¡ç®—ä½ç½®ç™¾åˆ†æ¯”ï¼ˆåŸºäºå±å¹•å®½åº¦ï¼‰\n      const position = (pageX / screenWidth) * 100\n      \n      // é™åˆ¶ä½ç½®åœ¨0-100%ä¹‹é—´\n      const clampedPosition = Math.max(0, Math.min(100, position))\n      setComparisonPosition(clampedPosition)\n    } catch (error) {\n      console.error('Error in handleComparisonMove:', error)\n    }\n  }\n\n  const handleDownload = async () => {\n    if (!processedImage) return\n\n    try {\n      await Taro.saveImageToPhotosAlbum({\n        filePath: processedImage\n      })\n      Taro.showToast({\n        title: 'å·²ä¿å­˜åˆ°ç›¸å†Œ',\n        icon: 'success'\n      })\n    } catch (err) {\n      // å¿½ç•¥ç”¨æˆ·å–æ¶ˆä¿å­˜çš„é”™è¯¯\n      if (err.errMsg !== 'saveImageToPhotosAlbum:fail cancel') {\n        console.error('Save failed:', err)\n        Taro.showToast({\n          title: 'ä¿å­˜å¤±è´¥',\n          icon: 'none'\n        })\n      }\n    }\n  }\n\n  const renderFeatureOptions = () => {\n    switch (featureType) {\n      case 'compress':\n        return (\n          <CompressFeature\n            quality={quality}\n            onQualityChange={(newQuality) => {\n              setQuality(newQuality)\n              setCustomQuality(Math.round(newQuality * 100).toString())\n            }}\n            onCompress={handleCompress}\n          />\n        )\n      \n      case 'resize':\n        return (\n          <ResizeFeature\n            scaleMode={scaleMode}\n            onScaleModeChange={setScaleMode}\n            onResize={handleResize}\n          />\n        )\n      \n      case 'convert':\n        return (\n          <ConvertFeature onConvert={handleConvert} />\n        )\n      \n      case 'edit':\n        return (\n          <EditFeature onRotate={handleRotate} onFlip={handleFlip} />\n        )\n      \n      case 'filter':\n        return (\n          <FilterFeature onFilter={handleFilter} />\n        )\n      \n      default:\n        return null\n    }\n  }\n\n  return (\n    <View className=\"editor\">\n      <Canvas\n        id=\"imageCanvas\"\n        canvasId=\"imageCanvas\"\n        type=\"2d\"\n        style={{ width: '0px', height: '0px', position: 'fixed', left: '-9999px' }}\n      />\n\n      <View className=\"editor-content\">\n        <View className=\"upload-content\">\n          {!image ? (\n            <View className=\"upload-placeholder\" onClick={selectImage}>\n              <Text className=\"upload-icon\">ğŸ–¼ï¸</Text>\n              <Text className=\"upload-text\">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡{featureType === 'compress' ? 'å‹ç¼©' : ''}</Text>\n            </View>\n          ) : processedImage ? (\n            <View className=\"comparison-container\">\n              {/* ç®€åŒ–çš„å¯¹æ¯”è§†å›¾ï¼Œä½¿ç”¨æŒ‰é’®åˆ‡æ¢ */}\n              <View className=\"comparison-wrapper\" style={{ position: 'relative' }}>\n                {/* æ˜¾ç¤ºå›¾ç‰‡ */}\n                <Image\n                  src={showOriginal ? image.src : processedImage}\n                  style={{\n                    width: '100%',\n                    height: '400rpx',\n                    objectFit: 'contain'\n                  }}\n                  mode=\"aspectFit\"\n                />\n                \n                {/* åˆ‡æ¢æŒ‰é’®ï¼ˆæ”¾åœ¨å›¾ç‰‡ä¸Šé¢ï¼‰ */}\n                <View style={{ \n                  position: 'absolute', \n                  top: '15rpx', \n                  right: '15rpx', \n                  display: 'flex', \n                  gap: '10rpx',\n                  zIndex: 10\n                }}>\n                  <View \n                    style={{\n                      padding: '8rpx 16rpx',\n                      borderRadius: '8rpx',\n                      backgroundColor: showOriginal ? '#6366f1' : 'rgba(30, 27, 75, 0.8)',\n                      border: '1rpx solid #6366f1',\n                      display: 'flex',\n                      alignItems: 'center'\n                    }}\n                    onClick={() => setShowOriginal(true)}\n                  >\n                    <Text style={{ \n                      fontSize: '12rpx', \n                      color: showOriginal ? 'white' : '#94a3b8',\n                      fontWeight: showOriginal ? '600' : '400'\n                    }}>\n                      åŸå›¾\n                    </Text>\n                  </View>\n                  <View \n                    style={{\n                      padding: '8rpx 16rpx',\n                      borderRadius: '8rpx',\n                      backgroundColor: !showOriginal ? '#6366f1' : 'rgba(30, 27, 75, 0.8)',\n                      border: '1rpx solid #6366f1',\n                      display: 'flex',\n                      alignItems: 'center'\n                    }}\n                    onClick={() => setShowOriginal(false)}\n                  >\n                    <Text style={{ \n                      fontSize: '12rpx', \n                      color: !showOriginal ? 'white' : '#94a3b8',\n                      fontWeight: !showOriginal ? '600' : '400'\n                    }}>\n                      å¤„ç†å\n                    </Text>\n                  </View>\n                </View>\n              </View>\n            </View>\n          ) : (\n            <>\n              <View className=\"image-preview-section\">\n                <Image\n                  src={image.src}\n                  className=\"preview-image\"\n                  mode=\"aspectFit\"\n                />\n              </View>\n            </>\n          )}\n        </View>\n        <View className=\"scrollable-content\">\n          {renderFeatureOptions()}\n        </View>\n\n        {/* åº•éƒ¨å›ºå®šæŒ‰é’®åŒºåŸŸ */}\n        <View className=\"bottom-buttons\">\n          <Button\n            className=\"bottom-btn select-btn\"\n            onClick={selectImage}\n          >\n            é€‰æ‹©å›¾ç‰‡\n          </Button>\n          {processedImage && (\n            <Button\n              className=\"bottom-btn save-btn\"\n              onClick={handleDownload}\n            >\n              ä¿å­˜å›¾ç‰‡\n            </Button>\n          )}\n        </View>\n\n        {isProcessing && (\n          <View className=\"loading-overlay\">\n            <Text className=\"loading-text\">å¤„ç†ä¸­...</Text>\n          </View>\n        )}\n      </View>\n    </View>\n  )\n}\n\nexport default Editor","import React from 'react'\nimport { View, Text, Button } from '@tarojs/components'\nimport '../styles/CompressOptions.css'\n\nconst qualityOptions = [\n  { label: 'ä½è´¨é‡', value: 0.3, description: '30%' },\n  { label: 'ä¸­ç­‰è´¨é‡', value: 0.5, description: '50%' },\n  { label: 'é«˜è´¨é‡', value: 0.7, description: '70%' },\n  { label: 'æœ€ä½³è´¨é‡', value: 0.9, description: '90%' }\n]\n\nexport const CompressOptions = ({\n  quality,\n  onQualityChange,\n  onCompress,\n  className = ''\n}) => {\n  return (\n    <View className={`compress-options ${className}`}>\n      <View className=\"option\">\n        <View className=\"size-option\">\n          {qualityOptions.map((option, index) => (\n            <Button\n              key={index}\n              className=\"size-option-btn\"\n              onClick={() => {\n                onQualityChange(option.value)\n                onCompress(option.value)\n              }}\n            >\n              <Text className=\"quality-label\">{option.label}</Text>\n              <Text className=\"quality-desc\">({option.description})</Text>\n            </Button>\n          ))}\n        </View>\n      </View>\n    </View>\n  )\n}\n","import React from 'react'\nimport { View, Text, Button } from '@tarojs/components'\nimport { CompressOptions } from '../../components/CompressOptions'\n\ninterface CompressFeatureProps {\n  quality: number\n  onQualityChange: (quality: number) => void\n  onCompress: (quality: number) => void\n}\n\nconst CompressFeature: React.FC<CompressFeatureProps> = ({\n  quality,\n  onQualityChange,\n  onCompress\n}) => {\n  return (\n    <View className=\"options-section\">\n      <Text className=\"options-title\">å‹ç¼©é€‰é¡¹</Text>\n      <CompressOptions \n        quality={quality} \n        onQualityChange={onQualityChange}\n        onCompress={onCompress}\n      />\n    </View>\n  )\n}\n\nexport default CompressFeature","import React from 'react'\nimport { View, Text, Button } from '@tarojs/components'\n\nconst formatOptions = [\n  { name: 'PNG', value: 'png' },\n  { name: 'JPEG', value: 'jpg' },\n  { name: 'JPG', value: 'jpg' },\n  { name: 'WebP', value: 'webp' },\n  { name: 'TIFF', value: 'tiff' },\n  { name: 'AVIF', value: 'avif' },\n  { name: 'BMP', value: 'bmp' },\n  { name: 'GIF', value: 'gif' },\n]\n\ninterface ConvertFeatureProps {\n  onConvert: (format: string) => void\n}\n\nconst ConvertFeature: React.FC<ConvertFeatureProps> = ({ onConvert }) => {\n  return (\n    <View className=\"options-section\">\n      <Text className=\"options-title\">æ ¼å¼è½¬æ¢</Text>\n      <View className=\"size-option\">\n        {formatOptions.map((format, index) => (\n          <Button\n            key={index}\n            className=\"size-option-btn\"\n            onClick={() => onConvert(format.value)}\n          >\n            {format.name}\n          </Button>\n        ))}\n      </View>\n    </View>\n  )\n}\n\nexport default ConvertFeature","import React from 'react'\nimport { View, Text, Button } from '@tarojs/components'\n\ninterface EditFeatureProps {\n  onRotate: (degrees: number) => void\n  onFlip: (direction: string) => void\n}\n\nconst EditFeature: React.FC<EditFeatureProps> = ({ onRotate, onFlip }) => {\n  return (\n    <View className=\"options-section\">\n      <Text className=\"options-title\">ç¼–è¾‘é€‰é¡¹</Text>\n      <View style={{ marginBottom: '20px' }}>\n        <Text style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '10px', display: 'block' }}>æ—‹è½¬</Text>\n        <View className=\"edit-buttons\">\n          <Button\n            className=\"action-btn\"\n            onClick={() => onRotate(-90)}\n          >\n            å·¦è½¬90Â°\n          </Button>\n          <Button\n            className=\"action-btn\"\n            onClick={() => onRotate(90)}\n          >\n            å³è½¬90Â°\n          </Button>\n          <Button\n            className=\"action-btn\"\n            onClick={() => onRotate(180)}\n          >\n            180Â°\n          </Button>\n        </View>\n      </View>\n      <View>\n        <Text style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '10px', display: 'block' }}>ç¿»è½¬</Text>\n        <View className=\"edit-buttons\">\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFlip('horizontal')}\n          >\n            æ°´å¹³ç¿»è½¬\n          </Button>\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFlip('vertical')}\n          >\n            å‚ç›´ç¿»è½¬\n          </Button>\n        </View>\n      </View>\n    </View>\n  )\n}\n\nexport default EditFeature","import React from 'react'\nimport { View, Text, Button } from '@tarojs/components'\n\ninterface FilterFeatureProps {\n  onFilter: (filterType: string, value: number) => void\n}\n\nconst FilterFeature: React.FC<FilterFeatureProps> = ({ onFilter }) => {\n  return (\n    <View className=\"options-section\">\n      <Text className=\"options-title\">æ»¤é•œæ•ˆæœ</Text>\n      <View style={{ marginBottom: '20px' }}>\n        <Text style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '10px', display: 'block' }}>é»‘ç™½</Text>\n        <View className=\"filter-buttons\">\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFilter('grayscale', 50)}\n          >\n            50%\n          </Button>\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFilter('grayscale', 100)}\n          >\n            100%\n          </Button>\n        </View>\n      </View>\n      <View style={{ marginBottom: '20px' }}>\n        <Text style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '10px', display: 'block' }}>å¤å¤</Text>\n        <View className=\"filter-buttons\">\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFilter('sepia', 50)}\n          >\n            50%\n          </Button>\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFilter('sepia', 100)}\n          >\n            100%\n          </Button>\n        </View>\n      </View>\n      <View>\n        <Text style={{ fontSize: '16px', color: 'var(--text-secondary)', marginBottom: '10px', display: 'block' }}>äº®åº¦</Text>\n        <View className=\"filter-buttons\">\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFilter('brightness', 120)}\n          >\n            å¢äº®\n          </Button>\n          <Button\n            className=\"action-btn\"\n            onClick={() => onFilter('brightness', 80)}\n          >\n            å˜æš—\n          </Button>\n        </View>\n      </View>\n    </View>\n  )\n}\n\nexport default FilterFeature","import React from 'react'\nimport { View, Text, Button } from '@tarojs/components'\n\nconst sizeOptions = [\n  { name: 'ä¸€å¯¸', width: 295, height: 413 },\n  { name: 'å°äºŒå¯¸', width: 413, height: 531 },\n  { name: 'äºŒå¯¸', width: 413, height: 626 },\n  { name: 'ç¤¾ä¿/èº«ä»½è¯', width: 358, height: 441 },\n  { name: 'å››å…­çº§/è®¡ç®—æœº', width: 144, height: 192 },\n  { name: 'å«ç”Ÿæœºæ„', width: 160, height: 210 },\n  { name: 'æ¯•ä¸šè¯', width: 480, height: 640 }\n]\n\nconst scaleOptions = [\n  { name: 'å¡«æ»¡ç”»é¢ï¼ˆè£è¾¹ï¼‰', value: 'cover' },\n  { name: 'å®Œæ•´æ˜¾ç¤ºï¼ˆç•™ç©ºç™½ï¼‰', value: 'contain' },\n  { name: 'æ‹‰ä¼¸å¡«æ»¡ï¼ˆå˜å½¢ï¼‰', value: 'stretch' },\n  { name: 'ä¿ç•™å®Œæ•´ï¼ˆå¯èƒ½å°ï¼‰', value: 'keep' },\n  { name: 'è‡³å°‘è¦†ç›–ï¼ˆå¯èƒ½è¶…å‡ºï¼‰', value: 'cover_min' }\n]\n\ninterface ResizeFeatureProps {\n  scaleMode: string\n  onScaleModeChange: (mode: string) => void\n  onResize: (width: number, height: number, scaleMode: string) => void\n}\n\nconst ResizeFeature: React.FC<ResizeFeatureProps> = ({\n  scaleMode,\n  onScaleModeChange,\n  onResize\n}) => {\n  return (\n    <View className=\"options-section\">\n      <View>\n        <Text className=\"options-title\">å°ºå¯¸é€‰é¡¹</Text>\n        <View className=\"size-option\">\n          {sizeOptions.map((option, index) => (\n            <Button\n              className=\"size-option-btn\"\n              key={index}\n              onClick={() => {\n                onResize(option.width, option.height, scaleMode)\n              }}\n            >\n              {option.name} ({option.width}x{option.height})\n            </Button>\n          ))}\n        </View>\n      </View>\n      <View>\n        <Text className=\"options-title\">ç¼©æ”¾æ–¹å¼</Text>\n        <View className=\"size-option\">\n          {scaleOptions.map((option, index) => (\n            <View\n              key={index}\n              className=\"size-option-btn\"\n              onClick={() => onScaleModeChange(option.value)}\n            >\n              {option.name}\n            </View>\n          ))}\n        </View>\n      </View>\n    </View>\n  )\n}\n\nexport default ResizeFeature","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/editor/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"å›¾ç‰‡ç¼–è¾‘\",\"navigationBarBackgroundColor\":\"#fff\",\"navigationBarTextStyle\":\"black\"};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/editor/index', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}